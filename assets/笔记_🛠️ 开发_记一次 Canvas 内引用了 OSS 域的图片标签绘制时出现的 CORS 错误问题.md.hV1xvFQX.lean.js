import{_ as c,c as d,J as t,m as e,a as s,w as o,V as n,E as l,o as p}from"./chunks/framework.WH0rnJL5.js";const _="/assets/canvas-referenced-oss-cross-origin-image-as-source-img-element-caused-cors-error-record-screenshot-01.V1nakEIe.png",se=JSON.parse('{"title":"è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜","description":"","frontmatter":{"tags":["å¼€å‘/å‰ç«¯","è®¡ç®—æœº/ç½‘ç»œ/è·¨åŸŸ","è®¡ç®—æœº/ç½‘ç»œ/è·¨åŸŸ/CORS","å¼€å‘/æ ‡è®°è¯­è¨€/HTML","å¼€å‘/æ ‡è®°è¯­è¨€/HTML/Canvas","åŸºç¡€è®¾æ–½/å­˜å‚¨/å¯¹è±¡å­˜å‚¨/é˜¿é‡Œäº‘/OSS","åŸºç¡€è®¾æ–½/äº‘æœåŠ¡å•†/é˜¿é‡Œäº‘/Aliyun"]},"headers":[],"relativePath":"ç¬”è®°/ğŸ› ï¸ å¼€å‘/è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜.md","filePath":"ç¬”è®°/ğŸ› ï¸ å¼€å‘/è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜.md"}'),u={name:"ç¬”è®°/ğŸ› ï¸ å¼€å‘/è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜.md"},g=e("h1",{id:"è®°ä¸€æ¬¡-canvas-å†…å¼•ç”¨äº†-oss-åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„-cors-é”™è¯¯é—®é¢˜",tabindex:"-1"},[s("è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜ "),e("a",{class:"header-anchor",href:"#è®°ä¸€æ¬¡-canvas-å†…å¼•ç”¨äº†-oss-åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„-cors-é”™è¯¯é—®é¢˜","aria-label":'Permalink to "è®°ä¸€æ¬¡ Canvas å†…å¼•ç”¨äº† OSS åŸŸçš„å›¾ç‰‡æ ‡ç­¾ç»˜åˆ¶æ—¶å‡ºç°çš„ CORS é”™è¯¯é—®é¢˜"'},"â€‹")],-1),k=n("",6),S=e("code",null,"Access-Control-Allow-Origin: *",-1),C=e("code",null,"useCORS: true",-1),m=n("",11),A=e("code",null,"<img>",-1),O=e("code",null,"crossorigin",-1),f=n("",4),b=n("",9),v=e("strong",null,[e("code",null,"<img>"),s(" æ ‡ç­¾èƒ½å¤ŸåŠ  crossorigin å±æ€§æ¥å¼ºåˆ¶ CORSï¼Œé‚£ CSS é‡Œé¢çš„å›¾ç‰‡æ€ä¹ˆåŠï¼Ÿ")],-1),B=e("p",null,"æ„æ€æ˜¯è¯´ï¼š",-1),y=e("blockquote",null,[e("p",null,[s("åœ¨åšäº†ä¸€äº›ç ”ç©¶ä¹‹åï¼Œæˆ‘ç¡®å®šçœŸæ­£çš„é—®é¢˜æ˜¯å³ä½¿å°† Amazon S3 é…ç½®ä¸ºæ”¯æŒ CORS çš„æƒ…å†µä¸‹ï¼ŒAmazon S3 ä¾ç„¶æ²¡æœ‰"),e("strong",null,'è‡ªåŠ¨è®¾ç½® "Vary:Origin "å¤´'),s("ã€‚å¦‚æœæœ‰äººçŸ¥é“å¦‚ä½•è®©S3åšåˆ°è¿™ä¸€ç‚¹ï¼Œé‚£ä¹Ÿå°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç­”æ¡ˆã€‚")])],-1),w=e("p",null,[s("å’¦ï¼Œè¿™ä¸ª "),e("code",null,"Vary: Origin"),s(" çœ‹èµ·æ¥éå¸¸çœ¼ç†Ÿï¼Œä¹‹å‰åœ¨ OSS çš„è·¨åŸŸé…ç½®ä¸­çœ‹åˆ°è¿‡ï¼Œä½†æ˜¯ä»æœªä»”ç»†äº†è§£è¿‡å…·ä½“çš„å«ä¹‰ã€‚ä½†æ˜¯æˆ‘ä»¬èƒ½åœ¨å¦ä¸€ä¸ªå›ç­”ä¸­èƒ½æ‰¾åˆ°äº›è®¸çº¿ç´¢ï¼š")],-1),T=e("code",null,"Access-Control-Allow-Origin",-1),q=e("code",null,"Vary: Origin",-1),R=e("code",null,"Access-Control-Allow-Origin",-1),P=e("p",null,"å…¶å«ä¹‰æ˜¯ï¼š",-1),D=e("blockquote",null,[e("p",null,[s("æ˜¯çš„ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚å¯èƒ½åŒ…å«æœ‰ä¸åŒå€¼çš„ "),e("code",null,"Access-Control-Allow-Origin"),s("ï¼Œå³ä½¿è¯·æ±‚æ²¡æœ‰åŒ…å« "),e("code",null,"Access-Control-Allow-Origin"),s(" å¤´çš„å“åº”ï¼Œé‚£ä¹ˆ CDN åº”è¯¥æ€»æ˜¯åŒ…å«è¿”å› "),e("code",null,"Vary:Origin"),s(" å¤´éƒ¨ï¼Œä½ çš„åˆ†ææ˜¯æ­£ç¡®çš„ï¼šå¦‚æœå¤´ä¿¡æ¯ä¸æ€»æ˜¯å­˜åœ¨ï¼Œå°±æœ‰å¯èƒ½ç”¨ä¸æ­£ç¡®çš„å€¼å¡«å……ç¼“å­˜ã€‚")])],-1),E=e("code",null,"Vary",-1),N=e("blockquote",null,[e("p",null,[e("strong",null,[e("code",null,"Vary")]),s("Â æ˜¯ä¸€ä¸ª HTTP å“åº”å¤´éƒ¨ä¿¡æ¯ï¼Œå®ƒå†³å®šäº†å¯¹äºæœªæ¥çš„ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œåº”è¯¥ç”¨ä¸€ä¸ªç¼“å­˜çš„å›å¤ (response) è¿˜æ˜¯å‘æºæœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªæ–°çš„å›å¤ã€‚")])],-1),V=e("p",null,"è¿™å¥è¯å¯èƒ½ä¸å¤ªèƒ½è¯´æ˜é—®é¢˜ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ MDN æä¾›çš„ä¸‹é¢çš„ä¾‹å­ï¼š",-1),F=e("code",null,"Vary",-1),I=e("code",null,"User-Agent",-1),x=e("p",null,[s("å³æ­¤æ—¶éœ€è¦è®¾ç½®ä¸º "),e("code",null,"Vary: User-Agent")],-1),H=e("p",null,[s("ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬éœ€è¦æ ¹æ® User-Agent çš„ä¸åŒæŒ‡æŒ¥æµè§ˆå™¨å»è¯»å†™ç¼“å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä½¿ç”¨ "),e("code",null,"Vary: User-Agent"),s(" å¤´æ¥å®ç°ã€‚")],-1),M=e("p",null,[s("æ­¤åˆ»æˆ‘ä»¬å†å»çœ‹çœ‹é˜¿é‡Œäº‘ OSS çš„è·¨åŸŸè®¾ç½®é€‰é¡¹å½“ä¸­çš„æœ€åä¸€é¡¹ä¸‹é¢çš„æ³¨é‡Šï¼š"),e("strong",null,"è¿”å› Vary: Origin")],-1),L=e("p",null,[e("img",{src:_,alt:""})],-1),U=e("p",null,[s("å…³é”®çš„ä¿¡æ¯æ˜¯ï¼š"),e("strong",null,"å¦‚æœæµè§ˆå™¨åŒæ—¶å­˜åœ¨ CORS å’Œé CORS è¯·æ±‚ï¼Œè¯·å¯ç”¨è¯¥é€‰é¡¹å¦åˆ™ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ã€‚")],-1),z=e("code",null,"Origin: <è¯·æ±‚æ¥æºåŸŸå>",-1),G=e("code",null,"Vary: Origin",-1),W=n("",7),$=e("h2",{id:"æ–‡ä»¶å†å²",tabindex:"-1"},[s("æ–‡ä»¶å†å² "),e("a",{class:"header-anchor",href:"#æ–‡ä»¶å†å²","aria-label":'Permalink to "æ–‡ä»¶å†å²"'},"â€‹")],-1);function j(J,X,Y,K,Q,Z){const i=l("NolebasePageProperties"),a=l("VPNolebaseInlineLinkPreview"),r=l("NolebaseGitContributors"),h=l("NolebaseGitChangelog");return p(),d("div",null,[g,t(i),k,e("p",null,[s("è°ƒæŸ¥æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°çš„æ—¶å€™å‘ç°æ˜¯å›¾ç‰‡ç›¸å…³çš„å“åº”æœªæ­£ç¡®æŒ‰ç…§ CORS æœŸæœ›çš„è®¾å®šè¿”å› "),S,s(" å¤´éƒ¨ï¼Œè§¦å‘äº† CORS ç­–ç•¥é”™è¯¯å¯¼è‡´ã€‚ è€Œå¦‚æœä¸ä½¿ç”¨ CORS ç­–ç•¥ï¼ˆå³æ‰“å¼€ html2canvas é…ç½®é€‰é¡¹ä¸­çš„ "),C,s(" é€‰é¡¹ï¼‰è¯·æ±‚å›¾ç‰‡çš„è¯ï¼Œä¼šå¯¼è‡´ canvas å˜æˆä¸å®‰å…¨çš„ canvasï¼Œæˆ–è€…è¯´æ˜¯è¢«æ±¡æŸ“çš„ canvasï¼ˆå‚è§ï¼š"),t(a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("å¯ç”¨äº† CORS çš„å›¾ç‰‡ - HTMLï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼‰ | MDN")]),_:1}),s("ï¼‰ï¼Œåœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå°†ä¸å¯ä½¿ç”¨ canvas ä¸Šä¸‹æ–‡ context è°ƒç”¨ä¸‹åˆ—å‡½æ•°ï¼š")]),m,e("p",null,[s("åœ¨ç½‘ç»œä¸Šæœç´¢ç›¸å…³èµ„æ–™çš„æ—¶å€™å‘ç°å¤§å¤šæ•°äººéƒ½æåˆ°äº†ä¸€ä¸ªä¹‹å‰æˆ‘ä»¬å¼€å‘æ—¶å¿½ç•¥çš„ "),A,s(" å±æ€§ "),O,s("ï¼ˆå‚è€ƒèµ„æ–™ï¼š"),t(a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/crossOrigin#value",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("HTMLImageElement.crossOrigin - Web APIs | MDN")]),_:1}),s("ï¼‰ã€‚")]),f,e("ul",null,[e("li",null,[e("p",null,[t(a,{href:"https://stackoverflow.com/questions/29105249/html2canvas-with-cors-in-s3-and-cloudfront",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("javascript - HTML2Canvas with CORS in S3 and CloudFront - Stack Overflow")]),_:1})])]),e("li",null,[e("p",null,[t(a,{href:"https://stackoverflow.com/questions/46257444/how-to-avoid-cors-error-when-drawing-image-onto-canvas",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("javascript - How to avoid CORS error when drawing image onto canvas? - Stack Overflow")]),_:1})])])]),b,e("p",null,[s("å…ˆå‰çš„é—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³ï¼Œäºæ˜¯æˆ‘å»ç»§ç»­å¯»æ‰¾å…¶ä»–é—®é¢˜çš„ç­”æ¡ˆã€‚æœ‰å¦ä¸€ä¸ªé—®é¢˜æ˜¯å°éŸ³è¯¢é—®æˆ‘çš„ï¼š"),v,s("ã€‚è¯´å®è¯æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œäºæ˜¯åœ¨ç½‘ç»œä¸Šæœç´¢ã€‚ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘åœ¨ "),t(a,{href:"https://stackoverflow.com/questions/21638606/using-cors-headers-with-css-background-image",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("cross domain - Using CORS headers with CSS background-image - Stack Overflow")]),_:1}),s(" StackOverflow é—®ç­”ä¸Šè§åˆ°äº†ä¸€å¥è¯„è®ºï¼š")]),e("blockquote",null,[e("p",null,[s(`After doing some research I have determined that the real problem is that Amazon S3 doesn't set the "Vary: Origin" header even if it is configured to support CORS. If anyone knows how to get S3 to do that, that would also be a good answer. â€“Â `),t(a,{href:"https://stackoverflow.com/users/2543666/thayne",title:"6,381 reputation",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Thayne")]),_:1}),s(),t(a,{href:"https://stackoverflow.com/questions/21638606/using-cors-headers-with-css-background-image#comment32821554_21638606",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Feb 11, 2014 at 16:17")]),_:1})])]),B,y,w,e("blockquote",null,[e("p",null,[s("Yes. If a request may contain aÂ "),T,s("Â with different values, then the CDN should always respond withÂ "),q,s(", even for responses without anÂ "),R,s("Â header. Your analysis is correct: if the header isn't always present, it would be possible to fill the cache with incorrect values. â€“ "),t(a,{href:"https://stackoverflow.com/users/107250/monsur",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("monsur")]),_:1}),t(a,{href:"https://stackoverflow.com/a/25329887",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("answeredÂ Aug 15, 2014 at 16:02")]),_:1})])]),P,D,e("p",null,[s("æ­¤æ—¶æ­¤åˆ»æˆ‘ä»¬å»å¯»æ‰¾ MDN å…³äº "),E,s(" å¤´éƒ¨çš„æ–‡æ¡£ "),t(a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Vary",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Vary - HTTP | MDN")]),_:1}),s("ï¼Œå°±èƒ½çœ‹åˆ°ï¼š")]),N,V,e("blockquote",null,[e("p",null,[s("å“ªç§æƒ…å†µä¸‹ä½¿ç”¨ "),F,s("ï¼Ÿå¯¹äº "),I,s("Â å¤´éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚ä½ æä¾›ç»™ç§»åŠ¨ç«¯çš„å†…å®¹æ˜¯ä¸åŒçš„ï¼Œå¯ç”¨é˜²æ­¢ä½ å®¢æˆ·ç«¯è¯¯ä½¿ç”¨äº†ç”¨äºæ¡Œé¢ç«¯çš„ç¼“å­˜ã€‚ å¹¶å¯å¸®åŠ© Google å’Œå…¶ä»–æœç´¢å¼•æ“æ¥å‘ç°ä½ çš„ç§»åŠ¨ç«¯ç‰ˆæœ¬çš„é¡µé¢ï¼ŒåŒæ—¶å‘ŠçŸ¥ä»–ä»¬ä¸éœ€è¦ "),t(a,{href:"https://en.wikipedia.org/wiki/Cloaking",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Cloaking")]),_:1}),s("ã€‚")]),x,e("p",null,[s("â€”â€” æ¥æº "),t(a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Vary#%E5%8A%A8%E6%80%81%E6%9C%8D%E5%8A%A1",title:"Permalink to åŠ¨æ€æœåŠ¡",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("åŠ¨æ€æœåŠ¡")]),_:1})])]),H,M,L,U,e("p",null,[s("ç»¼ä¸Šæ‰€è¿°ï¼Œå¯¹äºåœ¨è·¨åŸŸåœºæ™¯ä¸‹çš„ GET è¯·æ±‚è€Œè¨€ï¼Œæˆ‘ä»¬èƒ½çŸ¥é“ç”±äº CORS ç­–ç•¥æ‰€äº§ç”Ÿçš„çš„ OPTIONS é¢„æ£€è¯·æ±‚ç›¸æ¯”é CORS ç­–ç•¥é™åˆ¶çš„çš„ GET è¯·æ±‚å¤šäº† "),z,s(" å¤´éƒ¨ï¼Œé‚£ä¹ˆå…ˆå‰åœ¨ "),t(a,{href:"https://stackoverflow.com/questions/21638606/using-cors-headers-with-css-background-image",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("cross domain - Using CORS headers with CSS background-image - Stack Overflow")]),_:1}),s(" StackOverflow é—®ç­”ä¸­çœ‹åˆ°çš„è¯„è®ºæ‰€æåˆ°çš„ "),G,s(" å¤´éƒ¨çš„ä½œç”¨å°±å¯ä»¥ç†è§£ä¸ºï¼š")]),W,t(r),$,t(h)])}const te=c(u,[["render",j]]);export{se as __pageData,te as default};
