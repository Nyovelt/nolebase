import{_ as o,c as r,J as a,m as s,w as e,a as i,V as l,E as t,o as d}from"./chunks/framework.WH0rnJL5.js";const ys=JSON.parse('{"title":"在 Kubeadm 部署的 Kubernetes 集群中安装 Cilium","description":"","frontmatter":{"tags":["运维/云原生/Kubernetes","运维/云原生/Kubernetes/K8s","开发/云原生/Kubernetes/K8s","开发/云原生/Kubernetes","运维/Cilium","命令行/cilium","软件/云原生/Cilium","命令行/kubeadm","软件/云原生/kubeadm","软件/云原生/kube-proxy","计算机/网络/Cilium","命令行/helm","软件/云原生/helm","开发/标记语言/YAML"]},"headers":[],"relativePath":"笔记/🧱 基础设施/🚢 Kubernetes/在 Kubeadm 部署的 Kubernetes 集群中安装 Cilium.md","filePath":"笔记/🧱 基础设施/🚢 Kubernetes/在 Kubeadm 部署的 Kubernetes 集群中安装 Cilium.md"}'),c={name:"笔记/🧱 基础设施/🚢 Kubernetes/在 Kubeadm 部署的 Kubernetes 集群中安装 Cilium.md"},g=s("h1",{id:"在-kubeadm-部署的-kubernetes-集群中安装-cilium",tabindex:"-1"},[i("在 Kubeadm 部署的 Kubernetes 集群中安装 Cilium "),s("a",{class:"header-anchor",href:"#在-kubeadm-部署的-kubernetes-集群中安装-cilium","aria-label":'Permalink to "在 Kubeadm 部署的 Kubernetes 集群中安装 Cilium"'},"​")],-1),F=s("h3",{id:"文档兼容性",tabindex:"-1"},[i("文档兼容性 "),s("a",{class:"header-anchor",href:"#文档兼容性","aria-label":'Permalink to "文档兼容性"'},"​")],-1),y=s("thead",null,[s("tr",null,[s("th",null,"主体"),s("th",null,"版本号"),s("th",null,"文档地址（如果有）")])],-1),u=s("td",null,"Kubernetes",-1),C=s("td",null,"1.28",-1),A=s("td",null,"Cilium",-1),m=s("td",null,"1.14.2",-1),B=s("td",null,"helm",-1),b=s("td",null,"v3.9.0",-1),E=s("h2",{id:"先决条件",tabindex:"-1"},[i("先决条件 "),s("a",{class:"header-anchor",href:"#先决条件","aria-label":'Permalink to "先决条件"'},"​")],-1),f=s("h2",{id:"准备配置文件",tabindex:"-1"},[i("准备配置文件 "),s("a",{class:"header-anchor",href:"#准备配置文件","aria-label":'Permalink to "准备配置文件"'},"​")],-1),_=s("p",null,[i("创建一个名为 "),s("code",null,"cilium-values.yml"),i(" 的配置文件并放到你喜欢的地方，之后我们需要使用 "),s("code",null,"cilium install"),i(" 根据这份配置文件产出最终 "),s("code",null,"helm install"),i(" 需要的配置文件。"),s("sup",{class:"footnote-ref"},[s("a",{href:"#fn1",id:"fnref1"},"[1]")])],-1),v=l("",1),D=s("code",null,"ipam.mode",-1),P=s("code",null,"kubernetes",-1),x=l("",44),w=s("code",null,"cilium",-1),q=s("code",null,"10.0.0.0/8",-1),I=s("sup",{class:"footnote-ref"},[s("a",{href:"#fn3",id:"fnref3"},"[3]")],-1),T=s("code",null,"10.0.0.0/8",-1),R=s("code",null,"10.",-1),N=s("code",null,"10.0.0.1",-1),K=s("code",null,"cilium",-1),S=s("code",null,"cilium install",-1),H=s("code",null,"helm install",-1),O=s("code",null,"ipam.operator.clusterPoolIPv4PodCIDRList",-1),M=s("code",null,"ipv4NativeRoutingCIDR",-1),V=l("",29),L=s("li",null,[i("如果是在中国大陆部署的机器，是不是因为 "),s("code",null,"1.1.1.1"),i(" 被墙了，如果是的话，可以检查一下代理是否配置正确，节点是否选择正确")],-1),$=l("",1),U=l("",9),G=s("h2",{id:"贡献者",tabindex:"-1"},[i("贡献者 "),s("a",{class:"header-anchor",href:"#贡献者","aria-label":'Permalink to "贡献者"'},"​")],-1),Y=s("h2",{id:"文件历史",tabindex:"-1"},[i("文件历史 "),s("a",{class:"header-anchor",href:"#文件历史","aria-label":'Permalink to "文件历史"'},"​")],-1),J=s("hr",{class:"footnotes-sep"},null,-1),z={class:"footnotes"},Z={class:"footnotes-list"},j={id:"fn1",class:"footnote-item"},Q=s("a",{href:"#fnref1",class:"footnote-backref"},"↩︎",-1),W={id:"fn2",class:"footnote-item"},X=s("code",null,"helm",-1),ss=s("code",null,"helm",-1),is=s("code",null,"cilium",-1),as=s("a",{href:"#fnref2",class:"footnote-backref"},"↩︎",-1),ns={id:"fn3",class:"footnote-item"},es=s("code",null,"10.0.0.0/8",-1),ls=s("code",null,"10",-1),ts=s("code",null,"10",-1),hs=s("a",{href:"#fnref3",class:"footnote-backref"},"↩︎",-1);function ps(ks,os,rs,ds,cs,gs){const h=t("NolebasePageProperties"),n=t("VPNolebaseInlineLinkPreview"),p=t("NolebaseGitContributors"),k=t("NolebaseGitChangelog");return d(),r("div",null,[g,a(h),F,s("table",null,[y,s("tbody",null,[s("tr",null,[u,C,s("td",null,[a(n,{href:"https://v1-28.docs.kubernetes.io/",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("https://v1-28.docs.kubernetes.io/")]),_:1})])]),s("tr",null,[A,m,s("td",null,[a(n,{href:"https://docs.cilium.io/en/v1.14/",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("https://docs.cilium.io/en/v1.14/")]),_:1})])]),s("tr",null,[B,b,s("td",null,[a(n,{href:"https://helm.sh/docs/",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("https://helm.sh/docs/")]),_:1})])])])]),E,s("ul",null,[s("li",null,[a(n,{href:"/笔记/🧱 基础设施/🚢 Kubernetes/为安装 CNI 使用 Kubeadm 准备一个 Kubernetes 集群.html"},{default:e(()=>[i("为安装 CNI 使用 Kubeadm 准备一个 Kubernetes 集群")]),_:1})])]),f,_,s("p",null,[i("对于一个根据"),a(n,{href:"#先决条件"},{default:e(()=>[i("先决条件")]),_:1}),i("中的要求，我们可以撰写如下的文件内容：")]),v,s("p",null,[i("对于 "),D,i(" 为 "),P,i("，你可以在 "),a(n,{href:"https://docs.cilium.io/en/stable/network/concepts/ipam/cluster-pool/",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Cluster Scope (Default) — Cilium 1.14.2 documentation")]),_:1}),i(" 和 "),a(n,{href:"https://docs.cilium.io/en/stable/network/concepts/ipam/kubernetes/",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Kubernetes Host Scope — Cilium 1.14.2 documentation")]),_:1}),i(" 了解更多。")]),x,s("p",null,[i("这样的命令在 Kubernetes 集群中安装，那 "),w,i(" 是默认使用的 "),a(n,{href:"https://docs.cilium.io/en/stable/network/concepts/ipam/cluster-pool/#ipam-crd-cluster-pool",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Cluster Scope (Default)")]),_:1}),i(" 作为 IPAM 的模式来运行，而 "),a(n,{href:"https://docs.cilium.io/en/stable/network/concepts/ipam/cluster-pool/#ipam-crd-cluster-pool",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Cluster Scope (Default)")]),_:1}),i(" 好巧不巧使用的默认的 CIDR 是 "),q,I,i("，如果你学过 CIDR（没有学过也不要紧，可以看看"),a(n,{href:"/笔记/🛠️ 开发/🕸 网络/IP 后面的斜杠是什么？.html"},{default:e(()=>[i("IP 后面的斜杠是什么？")]),_:1}),i("），你可以看出来 "),T,i(" 意味着 "),R,i(" 后面的数字都是可以被分配的，这也就意味着 "),N,i(" 也是 "),K,i(" 接管的流量的一部分了，所以会出现这样的问题。")]),s("p",null,[i("正确的做法是我们在安装的时候给参数或者在给 "),S,i(" 使用的或者 "),H,i(" 使用的配置文件中配置一下 "),O,i(" 和 "),M,i(" 这两个字段，配置的字面量与 Kubernetes 集群的配置相同即可。如果你想要删除 Cilium 重新部署，可以参考一下"),a(n,{href:"/笔记/🧱 基础设施/🚢 Kubernetes/完全卸载使用 Helm 安装的 Cilium.html"},{default:e(()=>[i("完全卸载使用 Helm 安装的 Cilium")]),_:1}),i(" 这篇文档的指引。")]),V,s("ol",null,[s("li",null,[i("如果说我们宿主机也无法访问 "),s("ol",null,[L,s("li",null,[i("如果说代理正确的话，那可能你可以参考一下 "),a(n,{href:"#因为-cidr-冲突导致的-host-网络异常"},{default:e(()=>[i("因为 CIDR 冲突导致的 Host 网络异常")]),_:1}),i("部分是否匹配你正在遭遇的故障，也许是因为 CIDR 的冲突导致 DNS 或者路由挂了")])])]),$]),U,s("ul",null,[s("li",null,[a(n,{href:"https://github.com/cilium/cilium/issues/16235",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Cannot reach external endpoint with service ip when the external endpoint is one of k8s node · Issue #16235 · cilium/cilium")]),_:1})]),s("li",null,[a(n,{href:"https://stackoverflow.com/questions/76432743/cant-access-the-external-network-from-pod-nginx-pod",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("kubernetes - Can’t access the external network from pod (nginx-pod) - Stack Overflow")]),_:1})]),s("li",null,[a(n,{href:"https://serverfault.com/questions/1103034/kubernetes-nodes-are-not-reachable-and-cannot-reach-local-network-after-installi",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("linux - Kubernetes Nodes are not reachable and cannot reach local network after installing cilium - Server Fault")]),_:1})]),s("li",null,[a(n,{href:"https://github.com/cilium/cilium/issues/20085",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Pod cannot access external network · Issue #20085 · cilium/cilium")]),_:1})]),s("li",null,[a(n,{href:"https://github.com/cilium/cilium/issues/22162",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("CI: ConformanceAKS: curl succeeded while it should have failed due to incorrect exit code · Issue #22162 · cilium/cilium")]),_:1})]),s("li",null,[a(n,{href:"https://github.com/cilium/cilium-cli/issues/673",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("cilium connectivity test failures · Issue #673 · cilium/cilium-cli")]),_:1})]),s("li",null,[a(n,{href:"https://github.com/kubernetes-sigs/kubespray/issues/8546",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Cilium deployment fails to pass conn test and sonobuoy · Issue #8546 · kubernetes-sigs/kubespray")]),_:1})])]),G,a(p),Y,a(k),J,s("section",z,[s("ol",Z,[s("li",j,[s("p",null,[i("虽然 "),a(n,{href:"https://docs.cilium.io/en/stable/installation/k8s-install-migration/",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Migrating a cluster to Cilium")]),_:1}),i(" 是专门为迁移到 Cilium 准备的文档，如果我们是全新的安装，那这里面有的步骤是不需要遵循的，但是我们可以借鉴一下部分的操作。 "),Q])]),s("li",W,[s("p",null,[i("在 "),a(n,{href:"https://docs.cilium.io/en/stable/installation/k8s-install-helm/",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Installation using Helm")]),_:1}),i(" 中讲解了如何使用 "),X,i(" 进行安装，"),ss,i(" 安装和直接用 "),is,i(" 安装其实底层上而言是一样的，但是配置的过程不同，也可以阅读一下这篇文档来了解区别。 "),as])]),s("li",ns,[s("p",null,[i("对于默认的 "),a(n,{href:"https://docs.cilium.io/en/stable/network/concepts/ipam/cluster-pool/#check-for-conflicting-node-cidrs",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Cluster Scope (Default)")]),_:1}),i(" 模式而言，Cilium 默认使用 "),es,i(" 作为 Pod 的 CIDR，不得不说是真的太野了，这样的 CIDR 返回将会覆盖整个 "),ls,i(" IP 段，很多内网基础设施都是选择的 "),ts,i(" 段，如果直接用默认配置肯定会出大问题。 "),hs])])])])])}const us=o(c,[["render",ps]]);export{ys as __pageData,us as default};
