import{_ as p,c as d,J as a,m as s,w as t,a as i,V as l,E as n,o}from"./chunks/framework.WH0rnJL5.js";const N=JSON.parse('{"title":"通过 kubeadm 部署 Kubernetes 集群的时候的问题排查","description":"","frontmatter":{"tags":["运维/云原生/Kubernetes","运维/云原生/Kubernetes/K8s","开发/云原生/Kubernetes","开发/云原生/Kubernetes/K8s","命令行/systemd","命令行/journalctl","计算机/操作系统/Linux","计算机/操作系统/Linux/命令行","操作系统/Linux","操作系统/Debian","操作系统/Debian/Debian-11","开发/虚拟化/cgroup","命令行/kubeadm","软件/云原生/kubeadm","命令行/kubectl","软件/云原生/kubectl","软件/云原生/kubelet","计算机/网络"]},"headers":[],"relativePath":"笔记/🧱 基础设施/🚢 Kubernetes/通过 Kubeadm 部署 Kubernetes 集群的时候的问题排查.md","filePath":"笔记/🧱 基础设施/🚢 Kubernetes/通过 Kubeadm 部署 Kubernetes 集群的时候的问题排查.md"}'),c={name:"笔记/🧱 基础设施/🚢 Kubernetes/通过 Kubeadm 部署 Kubernetes 集群的时候的问题排查.md"},u=s("h1",{id:"通过-kubeadm-部署-kubernetes-集群的时候的问题排查",tabindex:"-1"},[i("通过 "),s("code",null,"kubeadm"),i(" 部署 Kubernetes 集群的时候的问题排查 "),s("a",{class:"header-anchor",href:"#通过-kubeadm-部署-kubernetes-集群的时候的问题排查","aria-label":'Permalink to "通过 `kubeadm` 部署 Kubernetes 集群的时候的问题排查"'},"​")],-1),C=s("h3",{id:"文档兼容性",tabindex:"-1"},[i("文档兼容性 "),s("a",{class:"header-anchor",href:"#文档兼容性","aria-label":'Permalink to "文档兼容性"'},"​")],-1),g=s("thead",null,[s("tr",null,[s("th",null,"主体"),s("th",null,"版本号"),s("th",null,"文档地址（如果有）")])],-1),y=s("tr",null,[s("td",null,"Debian"),s("td",null,"11"),s("td")],-1),F=s("td",null,"Kubernetes",-1),b=s("td",null,"1.28",-1),A=s("td",null,"Docker",-1),m=s("td",null,"24.0.2",-1),_=s("tr",null,[s("td",null,"containerd"),s("td",null,"1.7.6"),s("td")],-1),f=s("tr",null,[s("td",null,"Linux kernel"),s("td",null,"5.10.0"),s("td")],-1),q=l(`<h3 id="malformed-header-missing-http-content-type" tabindex="-1"><code>malformed header: missing HTTP content-type</code> <a class="header-anchor" href="#malformed-header-missing-http-content-type" aria-label="Permalink to &quot;\`malformed header: missing HTTP content-type\`&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[kubelet-finalize] Updating </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/etc/kubernetes/kubelet.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> to point to a rotatable kubelet client certificate and key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">I1007</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:04:31.944913   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">61969</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubeletfinalize.go:134] [kubelet-finalize] Restarting the kubelet to enable client certificate rotation</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rpc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> error: code = Unknown desc = malformed header: missing HTTP content-type</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unable</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to create deployment</span></span></code></pre></div><p>请通过 <code>systemd</code> 检查 <code>kubelet</code> 是否运行正常，也可以直接通过 <code>journalctl -xeu kubelet</code> 来查看 <code>kubelet</code> 最后的日志。</p><p>首先确定你是否有添加 <code>--skip-phases=addon/kube-proxy</code> 参数去执行 <code>kubeadm init</code>，如果没有，你可能需要先排查一下 <code>kube-proxy</code> 或者说 HAProxy 的问题。</p><h3 id="net-http-request-canceled-client-timeout-exceeded-while-awaiting-headers" tabindex="-1"><code>net/http: request canceled (Client.Timeout exceeded while awaiting headers)</code> <a class="header-anchor" href="#net-http-request-canceled-client-timeout-exceeded-while-awaiting-headers" aria-label="Permalink to &quot;\`net/http: request canceled (Client.Timeout exceeded while awaiting headers)\`&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[kubelet-finalize] Updating </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/etc/kubernetes/kubelet.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> to point to a rotatable kubelet client certificate and key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">I1007</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 17</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:25:43.478404   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">54691</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubeletfinalize.go:134] [kubelet-finalize] Restarting the kubelet to enable client certificate rotation</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Put</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;https://10.24.0.2:6443/api/v1/namespaces/kube-system/services/kube-dns?timeout=10s&quot;: net/http: request canceled </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Client.Timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exceeded while awaiting headers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unable</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to create/update the DNS service</span></span></code></pre></div><p>请通过 <code>systemd</code> 检查 <code>kubelet</code> 是否运行正常，也可以直接通过 <code>journalctl -xeu kubelet</code> 来查看 <code>kubelet</code> 最后的日志。</p><p>首先确定你是否有添加 <code>--skip-phases=addon/kube-proxy</code> 参数去执行 <code>kubeadm init</code>，如果没有，你可能需要先排查一下 <code>kube-proxy</code> 或者说 HAProxy 的问题。</p><h3 id="failed-to-allocate-ip-ip-provided-ip-is-already-allocated" tabindex="-1"><code>failed to allocate IP &lt;IP&gt;: provided IP is already allocated</code> <a class="header-anchor" href="#failed-to-allocate-ip-ip-provided-ip-is-already-allocated" aria-label="Permalink to &quot;\`failed to allocate IP &lt;IP&gt;: provided IP is already allocated\`&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[kubelet-finalize] Updating </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/etc/kubernetes/kubelet.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> to point to a rotatable kubelet client certificate and key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">I1007</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:02:10.780271   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">60063</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubeletfinalize.go:134] [kubelet-finalize] Restarting the kubelet to enable client certificate rotation</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;kube-dns&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> is invalid: spec.clusterIPs: Invalid value: []string{&quot;10.96.0.10&quot;}: failed to allocate IP </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10.96</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.0.10: provided IP is already allocated</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unable</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to create/update the DNS service</span></span></code></pre></div><p>请通过 <code>systemd</code> 检查 <code>kubelet</code> 是否运行正常，也可以直接通过 <code>journalctl -xeu kubelet</code> 来查看 <code>kubelet</code> 最后的日志。</p><p>首先确定你是否有添加 <code>--skip-phases=addon/kube-proxy</code> 参数去执行 <code>kubeadm init</code>，如果没有，你可能需要先排查一下 <code>kube-proxy</code> 或者说 HAProxy 的问题。</p><h3 id="kubelet-在-journalctl-日志中的的-error-while-dialing-dial-unix-run-containerd-containerd-sock-connect-no-such-file-or-directory-错误" tabindex="-1"><code>kubelet</code> 在 <code>journalctl</code> 日志中的的 <code>Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</code> 错误 <a class="header-anchor" href="#kubelet-在-journalctl-日志中的的-error-while-dialing-dial-unix-run-containerd-containerd-sock-connect-no-such-file-or-directory-错误" aria-label="Permalink to &quot;\`kubelet\` 在 \`journalctl\` 日志中的的 \`Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory\` 错误&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">E1007</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:48.784251   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> remote_runtime.go:294] &quot;ListPodSandbox with filter from runtime service failed&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> err=&quot;rpc error: code = Unavailable desc = connection error: desc = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filter=&quot;nil&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:48 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: E1007 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:48.784310   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kuberuntime_sandbox.go:297] &quot;Failed to list pod sandboxes&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> err=&quot;rpc error: code = Unavailable desc = connection error: desc = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:48 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: E1007 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:48.784346   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> generic.go:238] &quot;GenericPLEG: Unable to retrieve pods&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> err=&quot;rpc error: code = Unavailable desc = connection error: desc = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:49 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: E1007 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:49.785335   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> remote_runtime.go:294] &quot;ListPodSandbox with filter from runtime service failed&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> err=&quot;rpc error: code = Unavailable desc = connection error: desc = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filter=&quot;nil&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:50 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: E1007 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:50.786291   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kuberuntime_sandbox.go:297] &quot;Failed to list pod sandboxes&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> err=&quot;rpc error: code = Unavailable desc = connection error: desc = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:50 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: E1007 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:50.786324   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> generic.go:238] &quot;GenericPLEG: Unable to retrieve pods&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> err=&quot;rpc error: code = Unavailable desc = connection error: desc = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: E1007 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51.182257   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> remote_runtime.go:633] &quot;Status from runtime service failed&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> err=&quot;rpc error: code = Unavailable desc = connection error: desc = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: E1007 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51.213930   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> remote_runtime.go:407] &quot;ListContainers with filter from runtime service failed&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> err=&quot;rpc error: code = Unavailable desc = connection error: desc = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filter=&quot;&amp;ContainerFilter{Id:,State:nil,PodSandboxId:,LabelSelector:map[string]string{},}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: E1007 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51.213991   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> container_log_manager.go:185] &quot;Failed to rotate container logs&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> err=&quot;failed to list containers: rpc error: code = Unavailable desc = connection error: desc = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: W1007 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51.787660   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logging.go:59] [core] [Channel #1 SubChannel #2] grpc: addrConn.createTransport failed to connect to {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]:   &quot;Addr&quot;: &quot;/run/containerd/containerd.sock&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]:   &quot;ServerName&quot;: &quot;/run/containerd/containerd.sock&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]:   &quot;Attributes&quot;: null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]:   &quot;BalancerAttributes&quot;: null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]:   &quot;Type&quot;: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]:   &quot;Metadata&quot;: null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">10月</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 07</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:12:51 node1 kubelet[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">62982</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">]: }. Err: connection error: desc = &quot;transport: Error while dialing: dial unix /run/containerd/containerd.sock: connect: no such file or directory&quot;</span></span></code></pre></div>`,14),D=l(`<blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># make a copy of the default containerd configuration</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">containerd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> config default </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\|</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sudo tee /etc/containerd/config.toml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># set to use systemd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;s/SystemdCgroup = false/SystemdCgroup = true/g&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/containerd/config.toml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># adjust pause image to what&#39;s actually installed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">PAUSE_IMAGE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> config images list </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\|</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> grep pause)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sed -i &quot;s,sandbox_image = .*,sandbox_image = </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$PAUSE_IMAGE</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">,g&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/containerd/config.toml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># restart the containerd service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl enable containerd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl restart container</span></span></code></pre></div></blockquote><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2>`,2),E=s("h2",{id:"贡献者",tabindex:"-1"},[i("贡献者 "),s("a",{class:"header-anchor",href:"#贡献者","aria-label":'Permalink to "贡献者"'},"​")],-1),v=s("h2",{id:"文件历史",tabindex:"-1"},[i("文件历史 "),s("a",{class:"header-anchor",href:"#文件历史","aria-label":'Permalink to "文件历史"'},"​")],-1);function x(B,P,w,I,K,S){const h=n("NolebasePageProperties"),e=n("VPNolebaseInlineLinkPreview"),k=n("NolebaseGitContributors"),r=n("NolebaseGitChangelog");return o(),d("div",null,[u,a(h),C,s("table",null,[g,s("tbody",null,[y,s("tr",null,[F,b,s("td",null,[a(e,{href:"https://v1-28.docs.kubernetes.io/",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("https://v1-28.docs.kubernetes.io/")]),_:1})])]),s("tr",null,[A,m,s("td",null,[a(e,{href:"https://docs.docker.com/",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("https://docs.docker.com/")]),_:1})])]),_,f])]),q,s("p",null,[i("是否有参照 "),a(e,{href:"https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/configure-cgroup-driver/",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("配置 cgroup 驱动 | Kubernetes")]),_:1}),i(" 配置过 CGroup Driver？如果没有，可以参考 "),a(e,{href:"/笔记/🧱 基础设施/🚢 Kubernetes/准备 Kubernetes 节点裸金属虚拟机.html"},{default:t(()=>[i("准备 Kubernetes 节点裸金属虚拟机")]),_:1}),i(" 或者 "),a(e,{href:"https://github.com/kubernetes/kubeadm/issues/2699",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Error during kubeadm init - addon phase with coreDNS · Issue #2699 · kubernetes/kubeadm")]),_:1}),i(" Issue 中的脚本进行配置：")]),D,s("p",null,[a(e,{href:"https://github.com/kubernetes/kubeadm/issues/2699",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Error during kubeadm init - addon phase with coreDNS · Issue #2699 · kubernetes/kubeadm")]),_:1})]),E,a(k),v,a(r)])}const U=p(c,[["render",x]]);export{N as __pageData,U as default};
