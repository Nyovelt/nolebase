import{_ as h,c as r,J as a,m as s,w as l,a as e,V as d,E as i,o as k}from"./chunks/framework.WH0rnJL5.js";const N=JSON.parse('{"title":"完全卸载集群内的 kube-proxy","description":"","frontmatter":{"tags":["运维/云原生/Kubernetes","运维/云原生/Kubernetes/K8s","开发/云原生/Kubernetes","开发/云原生/Kubernetes/K8s","软件/云原生/kubelet","命令行/kubectl","软件/云原生/kubectl","命令行/ip","命令行/ipvsadm","软件/云原生/ipvsadm","计算机/网络/Calico","运维/Calico","软件/云原生/Calico","运维/Cilium","计算机/网络/Cilium","命令行/cilium","软件/云原生/Cilium"]},"headers":[],"relativePath":"笔记/🧱 基础设施/🚢 Kubernetes/完全卸载集群内的 `kube-proxy`.md","filePath":"笔记/🧱 基础设施/🚢 Kubernetes/完全卸载集群内的 `kube-proxy`.md"}'),c={name:"笔记/🧱 基础设施/🚢 Kubernetes/完全卸载集群内的 `kube-proxy`.md"},u=s("h1",{id:"完全卸载集群内的-kube-proxy",tabindex:"-1"},[e("完全卸载集群内的 "),s("code",null,"kube-proxy"),e(),s("a",{class:"header-anchor",href:"#完全卸载集群内的-kube-proxy","aria-label":'Permalink to "完全卸载集群内的 `kube-proxy`"'},"​")],-1),b=s("h3",{id:"文档兼容性",tabindex:"-1"},[e("文档兼容性 "),s("a",{class:"header-anchor",href:"#文档兼容性","aria-label":'Permalink to "文档兼容性"'},"​")],-1),g=s("thead",null,[s("tr",null,[s("th",null,"主体"),s("th",null,"版本号"),s("th",null,"文档地址（如果有）")])],-1),y=s("td",null,"kubeadm",-1),m=s("td",null,"1.28",-1),_=s("code",null,"kube-proxy",-1),C=d('<h2 id="备份-kube-proxy-相关的配置" tabindex="-1">备份 <code>kube-proxy</code> 相关的配置 <a class="header-anchor" href="#备份-kube-proxy-相关的配置" aria-label="Permalink to &quot;备份 `kube-proxy` 相关的配置&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl get ds -n kube-system kube-proxy -o yaml</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-proxy-daemonset.yaml</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl get cm -n kube-system kube-proxy -o yaml</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kube-proxy-configmap.yaml</span></span></code></pre></div><h2 id="删除相关的-daemonset" tabindex="-1">删除相关的 <code>DaemonSet</code> <a class="header-anchor" href="#删除相关的-daemonset" aria-label="Permalink to &quot;删除相关的 `DaemonSet`&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sudo kubectl -n kube-system delete ds kube-proxy</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">daemonset.apps</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;kube-proxy&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> deleted</span></span></code></pre></div><h2 id="删除相关的-configmap" tabindex="-1">删除相关的 <code>ConfigMap</code> <a class="header-anchor" href="#删除相关的-configmap" aria-label="Permalink to &quot;删除相关的 `ConfigMap`&quot;">​</a></h2><p>目的是为了<strong>防止以后使用 <code>kubeadm</code> 升级 K8s 的时候重新安装了 <code>kube-proxy</code>（1.19 版本之后的 K8S ）</strong>。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sudo kubectl -n kube-system delete cm kube-proxy</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">configmap</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;kube-proxy&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> deleted</span></span></code></pre></div><h2 id="清除掉-iptables-规则和-ipvs-规则以及-ipvs0-网卡" tabindex="-1">清除掉 <code>iptables</code> 规则和 <code>ipvs</code> 规则以及 <code>ipvs0</code> 网卡 <a class="header-anchor" href="#清除掉-iptables-规则和-ipvs-规则以及-ipvs0-网卡" aria-label="Permalink to &quot;清除掉 `iptables` 规则和 `ipvs` 规则以及 `ipvs0` 网卡&quot;">​</a></h2><p>在每个节点机器上面使用 <code>root</code> 权限执行：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> iptables-save </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> KUBE </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> iptables-restore</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ipvsadm -C</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ip link del kube-ipvs0</span></span></code></pre></div><h2 id="重启节点" tabindex="-1">重启节点 <a class="header-anchor" href="#重启节点" aria-label="Permalink to &quot;重启节点&quot;">​</a></h2><p>执行完之后请务必重启节点。</p><h2 id="贡献者" tabindex="-1">贡献者 <a class="header-anchor" href="#贡献者" aria-label="Permalink to &quot;贡献者&quot;">​</a></h2>',13),F=s("h2",{id:"文件历史",tabindex:"-1"},[e("文件历史 "),s("a",{class:"header-anchor",href:"#文件历史","aria-label":'Permalink to "文件历史"'},"​")],-1);function v(x,f,A,P,q,B){const n=i("NolebasePageProperties"),t=i("VPNolebaseInlineLinkPreview"),o=i("NolebaseGitContributors"),p=i("NolebaseGitChangelog");return k(),r("div",null,[u,a(n),b,s("table",null,[g,s("tbody",null,[s("tr",null,[y,m,s("td",null,[a(t,{href:"https://v1-28.docs.kubernetes.io/",target:"_blank",rel:"noreferrer"},{default:l(()=>[e("https://v1-28.docs.kubernetes.io/")]),_:1})])])])]),s("p",null,[e("根据 "),a(t,{href:"https://tinychen.com/20230201-k8s-15-migrate-cni-from-calico-to-cilium/",target:"_blank",rel:"noreferrer"},{default:l(()=>[e("k8s系列15-calico有损迁移至cilium")]),_:1}),e(" 技术文档所分享的，我们可以在安装前配置和备份一下 "),_,e(" 相关资源和配置文件：")]),C,a(o),F,a(p)])}const K=h(c,[["render",v]]);export{N as __pageData,K as default};
