import{_ as k,c as r,J as t,m as s,a as i,w as e,V as l,E as n,o as u}from"./chunks/framework.WH0rnJL5.js";const d="/assets/how-to-develop-and-test-clusterpedia-screenshot-1.AEzC0iDn.png",c="/assets/how-to-develop-and-test-clusterpedia-screenshot-2.X4GKhLtu.png",q="/assets/how-to-develop-and-test-clusterpedia-screenshot-3.f2INXo1Y.png",j=JSON.parse('{"title":"如何开发和测试 Clusterpedia","description":"","frontmatter":{"tags":["开发/云原生/Kubernetes","开发/云原生/Kubernetes/K8s","开发/云原生/Kubernetes/Clusterpedia","开源/软件/Clusterpedia","开发","命令行","命令行/终端","开发/语言/Golang","命令行/go","命令行/make","命令行/curl","命令行/openssl","数学/密码学/证书/TLS/mTLS","数学/密码学/证书/证书机构/CA","数学/密码学/证书/TLS","开发/Git","命令行/git","命令行/kubectl","软件/云原生/kubectl"]},"headers":[],"relativePath":"笔记/🧱 基础设施/🚢 Kubernetes/如何开发和测试 Clusterpedia.md","filePath":"笔记/🧱 基础设施/🚢 Kubernetes/如何开发和测试 Clusterpedia.md"}'),g={name:"笔记/🧱 基础设施/🚢 Kubernetes/如何开发和测试 Clusterpedia.md"},y=s("h1",{id:"如何开发和测试-clusterpedia",tabindex:"-1"},[i("如何开发和测试 Clusterpedia "),s("a",{class:"header-anchor",href:"#如何开发和测试-clusterpedia","aria-label":'Permalink to "如何开发和测试 Clusterpedia"'},"​")],-1),C=s("h2",{id:"准备工作",tabindex:"-1"},[i("准备工作 "),s("a",{class:"header-anchor",href:"#准备工作","aria-label":'Permalink to "准备工作"'},"​")],-1),F=s("h3",{id:"准备-apiserver-之后通信的时候使用的-mtls-证书",tabindex:"-1"},[i("准备 apiserver 之后通信的时候使用的 mTLS 证书 "),s("a",{class:"header-anchor",href:"#准备-apiserver-之后通信的时候使用的-mtls-证书","aria-label":'Permalink to "准备 apiserver 之后通信的时候使用的 mTLS 证书"'},"​")],-1),m=l(`<h4 id="创建-ca" tabindex="-1">创建 CA <a class="header-anchor" href="#创建-ca" aria-label="Permalink to &quot;创建 CA&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> req -nodes -new -x509 -keyout ca.key -out ca.crt</span></span></code></pre></div><h4 id="创建客户端证书" tabindex="-1">创建客户端证书 <a class="header-anchor" href="#创建客户端证书" aria-label="Permalink to &quot;创建客户端证书&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> req -out client.csr -new -newkey rsa:4096 -nodes -keyout client.key -subj &quot;/CN=development/O=system:masters&quot;</span></span></code></pre></div><h4 id="签发客户端证书" tabindex="-1">签发客户端证书 <a class="header-anchor" href="#签发客户端证书" aria-label="Permalink to &quot;签发客户端证书&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> x509 -req -days </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">365</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -in client.csr -CA ca.crt -CAkey ca.key -set_serial </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">01</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -sha256 -out client.crt</span></span></code></pre></div><h4 id="打包客户端证书为-p12-证书" tabindex="-1">打包客户端证书为 p12 证书 <a class="header-anchor" href="#打包客户端证书为-p12-证书" aria-label="Permalink to &quot;打包客户端证书为 p12 证书&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pkcs12 -export -in ./client.crt -inkey ./client.key -out client.p12 -passout pass:password</span></span></code></pre></div><h3 id="准备-apiserver-测试时使用的临时数据库" tabindex="-1">准备 apiserver 测试时使用的临时数据库 <a class="header-anchor" href="#准备-apiserver-测试时使用的临时数据库" aria-label="Permalink to &quot;准备 apiserver 测试时使用的临时数据库&quot;">​</a></h3><p>本地测试的话，可以用 SQLite 来作为数据持久化：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">sqlite</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dsn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">file:test.db</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">lg</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  color</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  slowThreshold</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">100ms</span></span></code></pre></div><h3 id="使用-kind-创建测试用的集群" tabindex="-1">使用 kind 创建测试用的集群 <a class="header-anchor" href="#使用-kind-创建测试用的集群" aria-label="Permalink to &quot;使用 kind 创建测试用的集群&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kind</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> create cluster</span></span></code></pre></div><h3 id="部署一个-hello-world-工作负载方便之后测试" tabindex="-1">部署一个 Hello World 工作负载方便之后测试 <a class="header-anchor" href="#部署一个-hello-world-工作负载方便之后测试" aria-label="Permalink to &quot;部署一个 Hello World 工作负载方便之后测试&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> create deployment hello-node --image=registry.k8s.io/e2e-test-images/agnhost:2.39 -- /agnhost netexec --http-port=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span></span></code></pre></div><h3 id="在希望测试的集群中创建-namespace" tabindex="-1">在希望测试的集群中创建 Namespace <a class="header-anchor" href="#在希望测试的集群中创建-namespace" aria-label="Permalink to &quot;在希望测试的集群中创建 Namespace&quot;">​</a></h3><p>在开始之后的步骤之前，我们还需要在测试的集群中创建一下 <code>clusterpedia-system</code> Namespace：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apply -f https://raw.githubusercontent.com/clusterpedia-io/clusterpedia/main/deploy/clusterpedia_namespace.yaml</span></span></code></pre></div><h3 id="在希望测试的集群中应用-crd" tabindex="-1">在希望测试的集群中应用 CRD <a class="header-anchor" href="#在希望测试的集群中应用-crd" aria-label="Permalink to &quot;在希望测试的集群中应用 CRD&quot;">​</a></h3><p>Clusterpedia 用到了 <code>ClusterSyncResources</code> 和 <code>PediaCluster</code> 两种自定义资源类型，你需要通过</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apply -f https://raw.githubusercontent.com/clusterpedia-io/clusterpedia/main/kustomize/crds/cluster.clusterpedia.io_clustersyncresources.yaml</span></span></code></pre></div><p>和</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apply -f https://raw.githubusercontent.com/clusterpedia-io/clusterpedia/main/kustomize/crds/cluster.clusterpedia.io_pediaclusters.yaml</span></span></code></pre></div><p>分别为他们创建，创建之后再次使用</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get crd</span></span></code></pre></div><p>就可以看到 Clusterpedia 相关的 CRD 资源了：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">❯</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl get crd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                           CREATED AT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clustersyncresources.cluster.clusterpedia.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2023</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">-11-27T04:22:46Z</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pediaclusters.cluster.clusterpedia.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">          2023</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">-11-27T04:22:53Z</span></span></code></pre></div><p>当然你也可以通过</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> api-resources</span></span></code></pre></div><p>来找到他们，就像这样：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro has-focused-lines vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">❯</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl api-resources</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bindings</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                       v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Binding</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">componentstatuses</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                 cs           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        ComponentStatus</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">configmaps</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                        cm           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">endpoints</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                         ep           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Endpoints</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">events</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                            ev           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Event</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">limitranges</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       limits       v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         LimitRange</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">namespaces</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                        ns           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        Namespace</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nodes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                             no           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        Node</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">persistentvolumeclaims</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            pvc          v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         PersistentVolumeClaim</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">persistentvolumes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                 pv           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        PersistentVolume</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pods</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                              po           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Pod</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">podtemplates</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                   v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         PodTemplate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">replicationcontrollers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            rc           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         ReplicationController</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resourcequotas</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    quota        v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         ResourceQuota</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">secrets</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                        v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Secret</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">serviceaccounts</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                   sa           v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         ServiceAccount</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">services</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                          svc          v1                                     </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mutatingwebhookconfigurations</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                  admissionregistration.k8s.io/v1        </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        MutatingWebhookConfiguration</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">validatingwebhookconfigurations</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                admissionregistration.k8s.io/v1        </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        ValidatingWebhookConfiguration</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">customresourcedefinitions</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         crd,crds     apiextensions.k8s.io/v1                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        CustomResourceDefinition</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">apiservices</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                    apiregistration.k8s.io/v1              </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        APIService</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">controllerrevisions</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                            apps/v1                                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         ControllerRevision</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">daemonsets</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                        ds           apps/v1                                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         DaemonSet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">deployments</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       deploy       apps/v1                                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Deployment</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">replicasets</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       rs           apps/v1                                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         ReplicaSet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">statefulsets</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      sts          apps/v1                                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         StatefulSet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tokenreviews</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                   authentication.k8s.io/v1               </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        TokenReview</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">localsubjectaccessreviews</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      authorization.k8s.io/v1                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         LocalSubjectAccessReview</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">selfsubjectaccessreviews</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                       authorization.k8s.io/v1                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        SelfSubjectAccessReview</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">selfsubjectrulesreviews</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                        authorization.k8s.io/v1                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        SelfSubjectRulesReview</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subjectaccessreviews</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                           authorization.k8s.io/v1                </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        SubjectAccessReview</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">horizontalpodautoscalers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          hpa          autoscaling/v2                         </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         HorizontalPodAutoscaler</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cronjobs</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                          cj           batch/v1                               </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         CronJob</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">jobs</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                           batch/v1                               </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Job</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">certificatesigningrequests</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        csr          certificates.k8s.io/v1                 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        CertificateSigningRequest</span></span>
<span class="line has-focus"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clustersyncresources</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                           cluster.clusterpedia.io/v1alpha2       </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        ClusterSyncResources</span></span>
<span class="line has-focus"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pediaclusters</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                  cluster.clusterpedia.io/v1alpha2       </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        PediaCluster</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">leases</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                         coordination.k8s.io/v1                 </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Lease</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">endpointslices</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                 discovery.k8s.io/v1                    </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         EndpointSlice</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">events</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                            ev           events.k8s.io/v1                       </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Event</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">flowschemas</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                    flowcontrol.apiserver.k8s.io/v1beta3   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        FlowSchema</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">prioritylevelconfigurations</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    flowcontrol.apiserver.k8s.io/v1beta3   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        PriorityLevelConfiguration</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ingressclasses</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                 networking.k8s.io/v1                   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        IngressClass</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ingresses</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                         ing          networking.k8s.io/v1                   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Ingress</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">networkpolicies</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                   netpol       networking.k8s.io/v1                   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         NetworkPolicy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">runtimeclasses</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                 node.k8s.io/v1                         </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        RuntimeClass</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">poddisruptionbudgets</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              pdb          policy/v1                              </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         PodDisruptionBudget</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clusterrolebindings</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                            rbac.authorization.k8s.io/v1           </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        ClusterRoleBinding</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clusterroles</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                   rbac.authorization.k8s.io/v1           </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        ClusterRole</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rolebindings</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                   rbac.authorization.k8s.io/v1           </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         RoleBinding</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">roles</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                          rbac.authorization.k8s.io/v1           </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         Role</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">priorityclasses</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                   pc           scheduling.k8s.io/v1                   </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        PriorityClass</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">csidrivers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                     storage.k8s.io/v1                      </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        CSIDriver</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">csinodes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                       storage.k8s.io/v1                      </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        CSINode</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">csistoragecapacities</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                           storage.k8s.io/v1                      </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         CSIStorageCapacity</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">storageclasses</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                    sc           storage.k8s.io/v1                      </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        StorageClass</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">volumeattachments</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                              storage.k8s.io/v1                      </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        VolumeAttachment</span></span></code></pre></div><h2 id="构建和启动-clusterpedia-apiserver" tabindex="-1">构建和启动 Clusterpedia <code>apiserver</code> <a class="header-anchor" href="#构建和启动-clusterpedia-apiserver" aria-label="Permalink to &quot;构建和启动 Clusterpedia \`apiserver\`&quot;">​</a></h2><h3 id="构建" tabindex="-1">构建 <a class="header-anchor" href="#构建" aria-label="Permalink to &quot;构建&quot;">​</a></h3><p>通过 <code>make</code> 来执行构建</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apiserver</span></span></code></pre></div><p>如果遭遇了</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fatal:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> No names found, cannot describe anything.</span></span></code></pre></div><p>也可以考虑原地创建一个 <code>git tag</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tag -a v0.0.0 -m &quot;test: v0.0.0&quot;</span></span></code></pre></div><p>如果希望删掉的话</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tag -D v0.0.0</span></span></code></pre></div><h3 id="启动" tabindex="-1">启动 <a class="header-anchor" href="#启动" aria-label="Permalink to &quot;启动&quot;">​</a></h3><p>现在可以开启 <code>apiserver</code> 了</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">./bin/apiserver</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	--secure-port</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 8443</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	--storage-config</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sqlite.yaml --v=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	--client-ca-file</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ca.crt </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	--kubeconfig</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.kube/config </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	--authentication-kubeconfig</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.kube/config </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	--authorization-kubeconfig</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.kube/config</span></span></code></pre></div><h3 id="测试连接" tabindex="-1">测试连接 <a class="header-anchor" href="#测试连接" aria-label="Permalink to &quot;测试连接&quot;">​</a></h3><p>由于集群本身的测试还需要另一个 Clusterpedia 组件参与，接下来我们先试试看能不能通过 <code>/apis/clusterpedia.io/v1beta1/resources/version</code> 接口获取到版本相关的信息吧。</p><h4 id="使用-curl-来测试-clusterpedia-的-apiserver-是否正常运作" tabindex="-1">使用 <code>curl</code> 来测试 Clusterpedia 的 <code>apiserver</code> 是否正常运作 <a class="header-anchor" href="#使用-curl-来测试-clusterpedia-的-apiserver-是否正常运作" aria-label="Permalink to &quot;使用 \`curl\` 来测试 Clusterpedia 的 \`apiserver\` 是否正常运作&quot;">​</a></h4><p>然后你可以先用 curl 尝试调用一下接口看看是否正常</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fv</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -k</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cert-type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> P12 --cert client.p12:password </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   https://localhost:8443/apis/clusterpedia.io/v1beta1/resources/version</span></span></code></pre></div><p>比如这样：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">❯</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> curl  -k --cert-type P12 --cert client.p12:password </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   https://localhost:8443/apis/clusterpedia.io/v1beta1/resources/version</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;major&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;minor&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;gitVersion&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;v0.0.0-master+</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$Format</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:%H$&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;gitCommit&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$Format</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:%H$&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;gitTreeState&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;buildDate&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;1970-01-01T00:00:00Z&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;goVersion&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;go1.20.11&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;compiler&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;gc&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;platform&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;darwin/arm64&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}%</span></span></code></pre></div><p>当然，想要使用 Postman 直接测试请求也可以，但是需要一些额外的配置步骤，请参见下文。</p><h4 id="使用-postman-来测试-clusterpedia-的-apiserver-是否正常运作" tabindex="-1">使用 Postman 来测试 Clusterpedia 的 <code>apiserver</code> 是否正常运作 <a class="header-anchor" href="#使用-postman-来测试-clusterpedia-的-apiserver-是否正常运作" aria-label="Permalink to &quot;使用 Postman 来测试 Clusterpedia 的 \`apiserver\` 是否正常运作&quot;">​</a></h4>`,53),v=s("p",null,"在 macOS 上的 Postman 进行这样的配置的时候，首先在菜单栏中的 Postman 中点选「Settings...（设置...）」来打开设置界面。",-1),A=s("p",null,"然后在如下图所示的配置界面中的左侧找到「Certificates（证书）」，点选后在右手侧的「Client cetificates（客户端证书）」部分中点选「Add Certificate...（添加证书...）」来配置证书。",-1),b=s("p",null,[s("img",{src:d,alt:""})],-1),E=s("p",null,"接下来填写参数：",-1),f=l("<li>Host 需要填写我们开发和测试的时候 Clusterpedia <code>apiserver</code> 所在的 IP，本地开发测试的话填写 <code>localhsot</code> 就好了，端口填写我们上一步启动 <code>apiserver</code> 的时候传递的参数 <code>--secure-port 8443</code> 的 <code>8443</code> 作为端口号。</li><li>PFX File 需要点选并选中我们生成的 <code>client.p12</code> 证书文件</li>",2),B=s("code",null,"openssl",-1),_=s("code",null,"-passout pass:password",-1),D=s("code",null,"password",-1),P=l('<p><img src="'+c+'" alt=""></p><p>接下来新建一个请求，并且填写上我们之前使用 <code>curl</code> 去测试的时候请求的一模一样的 URL 去发送 GET 请求之后就能看到返回值了：</p><p><img src="'+q+`" alt=""></p><h2 id="构建和启动-clusterpedia-clustersynchro-manager" tabindex="-1">构建和启动 Clusterpedia <code>clustersynchro-manager</code> <a class="header-anchor" href="#构建和启动-clusterpedia-clustersynchro-manager" aria-label="Permalink to &quot;构建和启动 Clusterpedia \`clustersynchro-manager\`&quot;">​</a></h2><p>如果你刚才试着去通过</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>/apis/clusterpedia.io/v1beta1/resources/apis/apps/v1/deployments</span></span></code></pre></div><p>这个接口尝试请求访问 Kubernetes 当前集群中的 Deployments 的工作负载的话，你可能会发现服务器返回了 404 Not Found 的错误，这是因为 Clusterpedia 的 <code>apiserver</code> 组件并不会在启动之后自动遍历并且更新当前集群内已经存在的资源到 Clusterpedia 下属的数据持久化层，我们需要引入另一个名为</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>clustersynchro-manager</span></span></code></pre></div><p>的组件才能完成数据的同步和写入。</p><h3 id="构建-1" tabindex="-1">构建 <a class="header-anchor" href="#构建-1" aria-label="Permalink to &quot;构建&quot;">​</a></h3><p>使用下面的命令就能通过 <code>make</code> 来执行 <code>clustersynchro-manager</code> 组件的构建：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clustersynchro-manager</span></span></code></pre></div><h3 id="启动-1" tabindex="-1">启动 <a class="header-anchor" href="#启动-1" aria-label="Permalink to &quot;启动&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">./bin/clustersynchro-manager</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	--storage-config=./sqlite.yaml</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	--kubeconfig</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.kube/config </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	--feature-gates=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AllowSyncAllCustomResources=true&quot;</span></span></code></pre></div><h3 id="创建-pediacluster-资源" tabindex="-1">创建 <code>PediaCluster</code> 资源 <a class="header-anchor" href="#创建-pediacluster-资源" aria-label="Permalink to &quot;创建 \`PediaCluster\` 资源&quot;">​</a></h3><p>我们先在终端中执行</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.kube/config </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> base64</span></span></code></pre></div><p>来将 Clusterpedia <code>clustersynchro-manager</code> 组件用于访问集群的 <code>kubectl</code> 配置文件编码为 <code>base64</code> 之后复制一下；</p><p>如果你使用的是 macOS，也可以通过下面的命令一步到位</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.kube/config </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> base64</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> pbcopy</span></span></code></pre></div><p>接下来我们创建一个用于部署 PediaCluster 的文件：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nvim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pediacluster.yaml</span></span></code></pre></div><p>往里面写入下面的内容</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light one-dark-pro has-highlighted vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cluster.clusterpedia.io/v1alpha2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">PediaCluster</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line highlighted"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cluster-example</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 按需修改</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line highlighted"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  apiserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://localhost:8443&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # Kubernetes 集群 apiserver 的服务地址</span></span>
<span class="line highlighted"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  kubeconfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;base64 编码的 kubeconfig 文件内容&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  caData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  tokenData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  certData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  keyData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line highlighted"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  syncResources</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:  </span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">apps</span></span>
<span class="line highlighted"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    resources</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:  </span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">     - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">deployments</span></span></code></pre></div><p>需要注意的是，我们必须在 <code>spec.syncResources</code> 中添加我们希望 Clusterpedia 的 <code>clustersynchro-manager</code> 的资源类型和分组才能让 <code>clustersynchro-manager</code> 正常工作：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light one-dark-pro has-focused-lines vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cluster.clusterpedia.io/v1alpha2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">PediaCluster</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cluster-example</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 按需修改</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  apiserver</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://localhost:8443&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # Kubernetes 集群 apiserver 的服务地址</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  kubeconfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;base64 编码的 kubeconfig 文件内容&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  caData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  tokenData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  certData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  keyData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line has-focus"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  syncResources</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:  </span></span>
<span class="line has-focus"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">apps</span></span>
<span class="line has-focus"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    resources</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:  </span></span>
<span class="line has-focus"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">     - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">deployments</span></span></code></pre></div>`,26),T=s("code",null,"spec.syncResources",-1),S=l('<p>然后执行</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apply -f pediacluster.yaml</span></span></code></pre></div><p>就可以应用和创建 <code>PediaCluster</code> 资源了。</p><p>这个时候我们可以通过</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get pediacluster</span></span></code></pre></div><p>来观察是否完成索引，就像这样：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">❯</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl get pediacluster</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              READY   VERSION   APISERVER</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cluster-example</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   False   v1.27.3   https://127.0.0.1:61487</span></span></code></pre></div><p>可以注意关注一下 <code>READY</code> 字段的状态，只有为 <code>true</code> 的时候才代表资源都被遍历和索引完毕，就像这样：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">❯</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl get pediacluster</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              READY   VERSION   APISERVER</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cluster-example</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   True    v1.27.3   https://127.0.0.1:61487</span></span></code></pre></div><h3 id="检查数据库" tabindex="-1">检查数据库 <a class="header-anchor" href="#检查数据库" aria-label="Permalink to &quot;检查数据库&quot;">​</a></h3><p>接下来我们使用任意偏好的数据库管理工具来观察 SQLite 之后就可以看到下面的数据了：</p><table><thead><tr><th>id</th><th>group</th><th>version</th><th>resource</th><th>kind</th><th>cluster</th><th>namespace</th><th>name</th><th>owner_uid</th><th>uid</th><th>resource_version</th><th>object</th><th>created_at</th><th>synced_at</th><th>deleted_at</th></tr></thead><tbody><tr><td>1</td><td>apps</td><td>v1</td><td>deployments</td><td>Deployment</td><td>cluster-example</td><td>default</td><td>hello-node</td><td></td><td>b10236b0-429a-4739-a384-84f19ee6b092</td><td>514</td><td>{&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;Deployment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{&quot;deployment.kubernetes.io/revision&quot;:&quot;1&quot;,&quot;shadow.clusterpedia.io/cluster-name&quot;:&quot;cluster-example&quot;},&quot;creationTimestamp&quot;:&quot;2023-11-27T03:32:06Z&quot;,&quot;generation&quot;:1,&quot;labels&quot;:{&quot;app&quot;:&quot;hello-node&quot;},&quot;name&quot;:&quot;hello-node&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;resourceVersion&quot;:&quot;514&quot;,&quot;uid&quot;:&quot;b10236b0-429a-4739-a384-84f19ee6b092&quot;},&quot;spec&quot;:{&quot;progressDeadlineSeconds&quot;:600,&quot;replicas&quot;:1,&quot;revisionHistoryLimit&quot;:10,&quot;selector&quot;:{&quot;matchLabels&quot;:{&quot;app&quot;:&quot;hello-node&quot;}},&quot;strategy&quot;:{&quot;rollingUpdate&quot;:{&quot;maxSurge&quot;:&quot;25%&quot;,&quot;maxUnavailable&quot;:&quot;25%&quot;},&quot;type&quot;:&quot;RollingUpdate&quot;},&quot;template&quot;:{&quot;metadata&quot;:{&quot;creationTimestamp&quot;:null,&quot;labels&quot;:{&quot;app&quot;:&quot;hello-node&quot;}},&quot;spec&quot;:{&quot;containers&quot;:[{&quot;command&quot;:[&quot;/agnhost&quot;,&quot;netexec&quot;,&quot;--http-port=8080&quot;],&quot;image&quot;:&quot;registry.k8s.io/e2e-test-images/agnhost:2.39&quot;,&quot;imagePullPolicy&quot;:&quot;IfNotPresent&quot;,&quot;name&quot;:&quot;agnhost&quot;,&quot;resources&quot;:{},&quot;terminationMessagePath&quot;:&quot;/dev/termination-log&quot;,&quot;terminationMessagePolicy&quot;:&quot;File&quot;}],&quot;dnsPolicy&quot;:&quot;ClusterFirst&quot;,&quot;restartPolicy&quot;:&quot;Always&quot;,&quot;schedulerName&quot;:&quot;default-scheduler&quot;,&quot;securityContext&quot;:{},&quot;terminationGracePeriodSeconds&quot;:30}}},&quot;status&quot;:{&quot;availableReplicas&quot;:1,&quot;conditions&quot;:[{&quot;lastTransitionTime&quot;:&quot;2023-11-27T03:32:18Z&quot;,&quot;lastUpdateTime&quot;:&quot;2023-11-27T03:32:18Z&quot;,&quot;message&quot;:&quot;Deployment has minimum availability.&quot;,&quot;reason&quot;:&quot;MinimumReplicasAvailable&quot;,&quot;status&quot;:&quot;True&quot;,&quot;type&quot;:&quot;Available&quot;},{&quot;lastTransitionTime&quot;:&quot;2023-11-27T03:32:06Z&quot;,&quot;lastUpdateTime&quot;:&quot;2023-11-27T03:32:18Z&quot;,&quot;message&quot;:&quot;ReplicaSet &quot;hello-node-7579565d66&quot; has successfully progressed.&quot;,&quot;reason&quot;:&quot;NewReplicaSetAvailable&quot;,&quot;status&quot;:&quot;True&quot;,&quot;type&quot;:&quot;Progressing&quot;}],&quot;observedGeneration&quot;:1,&quot;readyReplicas&quot;:1,&quot;replicas&quot;:1,&quot;updatedReplicas&quot;:1}}</td><td>2023-11-27 11:32:06+08:00</td><td>2023-11-27 13:49:39.992135+08:00</td><td></td></tr><tr><td>2</td><td>apps</td><td>v1</td><td>deployments</td><td>Deployment</td><td>cluster-example</td><td>kube-system</td><td>coredns</td><td></td><td>baa17931-92c2-46dd-937a-6f78b2208431</td><td>440</td><td>{&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;Deployment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{&quot;deployment.kubernetes.io/revision&quot;:&quot;1&quot;,&quot;shadow.clusterpedia.io/cluster-name&quot;:&quot;cluster-example&quot;},&quot;creationTimestamp&quot;:&quot;2023-11-27T03:31:09Z&quot;,&quot;generation&quot;:1,&quot;labels&quot;:{&quot;k8s-app&quot;:&quot;kube-dns&quot;},&quot;name&quot;:&quot;coredns&quot;,&quot;namespace&quot;:&quot;kube-system&quot;,&quot;resourceVersion&quot;:&quot;440&quot;,&quot;uid&quot;:&quot;baa17931-92c2-46dd-937a-6f78b2208431&quot;},&quot;spec&quot;:{&quot;progressDeadlineSeconds&quot;:600,&quot;replicas&quot;:2,&quot;revisionHistoryLimit&quot;:10,&quot;selector&quot;:{&quot;matchLabels&quot;:{&quot;k8s-app&quot;:&quot;kube-dns&quot;}},&quot;strategy&quot;:{&quot;rollingUpdate&quot;:{&quot;maxSurge&quot;:&quot;25%&quot;,&quot;maxUnavailable&quot;:1},&quot;type&quot;:&quot;RollingUpdate&quot;},&quot;template&quot;:{&quot;metadata&quot;:{&quot;creationTimestamp&quot;:null,&quot;labels&quot;:{&quot;k8s-app&quot;:&quot;kube-dns&quot;}},&quot;spec&quot;:{&quot;affinity&quot;:{&quot;podAntiAffinity&quot;:{&quot;preferredDuringSchedulingIgnoredDuringExecution&quot;:[{&quot;podAffinityTerm&quot;:{&quot;labelSelector&quot;:{&quot;matchExpressions&quot;:[{&quot;key&quot;:&quot;k8s-app&quot;,&quot;operator&quot;:&quot;In&quot;,&quot;values&quot;:[&quot;kube-dns&quot;]}]},&quot;topologyKey&quot;:&quot;kubernetes.io/hostname&quot;},&quot;weight&quot;:100}]}},&quot;containers&quot;:[{&quot;args&quot;:[&quot;-conf&quot;,&quot;/etc/coredns/Corefile&quot;],&quot;image&quot;:&quot;registry.k8s.io/coredns/coredns:v1.10.1&quot;,&quot;imagePullPolicy&quot;:&quot;IfNotPresent&quot;,&quot;livenessProbe&quot;:{&quot;failureThreshold&quot;:5,&quot;httpGet&quot;:{&quot;path&quot;:&quot;/health&quot;,&quot;port&quot;:8080,&quot;scheme&quot;:&quot;HTTP&quot;},&quot;initialDelaySeconds&quot;:60,&quot;periodSeconds&quot;:10,&quot;successThreshold&quot;:1,&quot;timeoutSeconds&quot;:5},&quot;name&quot;:&quot;coredns&quot;,&quot;ports&quot;:[{&quot;containerPort&quot;:53,&quot;name&quot;:&quot;dns&quot;,&quot;protocol&quot;:&quot;UDP&quot;},{&quot;containerPort&quot;:53,&quot;name&quot;:&quot;dns-tcp&quot;,&quot;protocol&quot;:&quot;TCP&quot;},{&quot;containerPort&quot;:9153,&quot;name&quot;:&quot;metrics&quot;,&quot;protocol&quot;:&quot;TCP&quot;}],&quot;readinessProbe&quot;:{&quot;failureThreshold&quot;:3,&quot;httpGet&quot;:{&quot;path&quot;:&quot;/ready&quot;,&quot;port&quot;:8181,&quot;scheme&quot;:&quot;HTTP&quot;},&quot;periodSeconds&quot;:10,&quot;successThreshold&quot;:1,&quot;timeoutSeconds&quot;:1},&quot;resources&quot;:{&quot;limits&quot;:{&quot;memory&quot;:&quot;170Mi&quot;},&quot;requests&quot;:{&quot;cpu&quot;:&quot;100m&quot;,&quot;memory&quot;:&quot;70Mi&quot;}},&quot;securityContext&quot;:{&quot;allowPrivilegeEscalation&quot;:false,&quot;capabilities&quot;:{&quot;add&quot;:[&quot;NET_BIND_SERVICE&quot;],&quot;drop&quot;:[&quot;all&quot;]},&quot;readOnlyRootFilesystem&quot;:true},&quot;terminationMessagePath&quot;:&quot;/dev/termination-log&quot;,&quot;terminationMessagePolicy&quot;:&quot;File&quot;,&quot;volumeMounts&quot;:[{&quot;mountPath&quot;:&quot;/etc/coredns&quot;,&quot;name&quot;:&quot;config-volume&quot;,&quot;readOnly&quot;:true}]}],&quot;dnsPolicy&quot;:&quot;Default&quot;,&quot;nodeSelector&quot;:{&quot;kubernetes.io/os&quot;:&quot;linux&quot;},&quot;priorityClassName&quot;:&quot;system-cluster-critical&quot;,&quot;restartPolicy&quot;:&quot;Always&quot;,&quot;schedulerName&quot;:&quot;default-scheduler&quot;,&quot;securityContext&quot;:{},&quot;serviceAccount&quot;:&quot;coredns&quot;,&quot;serviceAccountName&quot;:&quot;coredns&quot;,&quot;terminationGracePeriodSeconds&quot;:30,&quot;tolerations&quot;:[{&quot;key&quot;:&quot;CriticalAddonsOnly&quot;,&quot;operator&quot;:&quot;Exists&quot;},{&quot;effect&quot;:&quot;NoSchedule&quot;,&quot;key&quot;:&quot;node-role.kubernetes.io/control-plane&quot;}],&quot;volumes&quot;:[{&quot;configMap&quot;:{&quot;defaultMode&quot;:420,&quot;items&quot;:[{&quot;key&quot;:&quot;Corefile&quot;,&quot;path&quot;:&quot;Corefile&quot;}],&quot;name&quot;:&quot;coredns&quot;},&quot;name&quot;:&quot;config-volume&quot;}]}}},&quot;status&quot;:{&quot;availableReplicas&quot;:2,&quot;conditions&quot;:[{&quot;lastTransitionTime&quot;:&quot;2023-11-27T03:31:28Z&quot;,&quot;lastUpdateTime&quot;:&quot;2023-11-27T03:31:28Z&quot;,&quot;message&quot;:&quot;Deployment has minimum availability.&quot;,&quot;reason&quot;:&quot;MinimumReplicasAvailable&quot;,&quot;status&quot;:&quot;True&quot;,&quot;type&quot;:&quot;Available&quot;},{&quot;lastTransitionTime&quot;:&quot;2023-11-27T03:31:24Z&quot;,&quot;lastUpdateTime&quot;:&quot;2023-11-27T03:31:37Z&quot;,&quot;message&quot;:&quot;ReplicaSet &quot;coredns-5d78c9869d&quot; has successfully progressed.&quot;,&quot;reason&quot;:&quot;NewReplicaSetAvailable&quot;,&quot;status&quot;:&quot;True&quot;,&quot;type&quot;:&quot;Progressing&quot;}],&quot;observedGeneration&quot;:1,&quot;readyReplicas&quot;:2,&quot;replicas&quot;:2,&quot;updatedReplicas&quot;:2}}</td><td>2023-11-27 11:31:09+08:00</td><td>2023-11-27 13:49:39.994086+08:00</td><td></td></tr><tr><td>3</td><td>apps</td><td>v1</td><td>deployments</td><td>Deployment</td><td>cluster-example</td><td>local-path-storage</td><td>local-path-provisioner</td><td></td><td>3da939ee-e549-4bf9-902d-3a4732374f9b</td><td>417</td><td>{&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;Deployment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{&quot;deployment.kubernetes.io/revision&quot;:&quot;1&quot;,&quot;shadow.clusterpedia.io/cluster-name&quot;:&quot;cluster-example&quot;},&quot;creationTimestamp&quot;:&quot;2023-11-27T03:31:11Z&quot;,&quot;generation&quot;:1,&quot;name&quot;:&quot;local-path-provisioner&quot;,&quot;namespace&quot;:&quot;local-path-storage&quot;,&quot;resourceVersion&quot;:&quot;417&quot;,&quot;uid&quot;:&quot;3da939ee-e549-4bf9-902d-3a4732374f9b&quot;},&quot;spec&quot;:{&quot;progressDeadlineSeconds&quot;:600,&quot;replicas&quot;:1,&quot;revisionHistoryLimit&quot;:10,&quot;selector&quot;:{&quot;matchLabels&quot;:{&quot;app&quot;:&quot;local-path-provisioner&quot;}},&quot;strategy&quot;:{&quot;rollingUpdate&quot;:{&quot;maxSurge&quot;:&quot;25%&quot;,&quot;maxUnavailable&quot;:&quot;25%&quot;},&quot;type&quot;:&quot;RollingUpdate&quot;},&quot;template&quot;:{&quot;metadata&quot;:{&quot;creationTimestamp&quot;:null,&quot;labels&quot;:{&quot;app&quot;:&quot;local-path-provisioner&quot;}},&quot;spec&quot;:{&quot;containers&quot;:[{&quot;command&quot;:[&quot;local-path-provisioner&quot;,&quot;--debug&quot;,&quot;start&quot;,&quot;--helper-image&quot;,&quot;docker.io/kindest/local-path-helper:v20230510-486859a6&quot;,&quot;--config&quot;,&quot;/etc/config/config.json&quot;],&quot;env&quot;:[{&quot;name&quot;:&quot;POD_NAMESPACE&quot;,&quot;valueFrom&quot;:{&quot;fieldRef&quot;:{&quot;apiVersion&quot;:&quot;v1&quot;,&quot;fieldPath&quot;:&quot;metadata.namespace&quot;}}}],&quot;image&quot;:&quot;docker.io/kindest/local-path-provisioner:v20230511-dc714da8&quot;,&quot;imagePullPolicy&quot;:&quot;IfNotPresent&quot;,&quot;name&quot;:&quot;local-path-provisioner&quot;,&quot;resources&quot;:{},&quot;terminationMessagePath&quot;:&quot;/dev/termination-log&quot;,&quot;terminationMessagePolicy&quot;:&quot;File&quot;,&quot;volumeMounts&quot;:[{&quot;mountPath&quot;:&quot;/etc/config/&quot;,&quot;name&quot;:&quot;config-volume&quot;}]}],&quot;dnsPolicy&quot;:&quot;ClusterFirst&quot;,&quot;nodeSelector&quot;:{&quot;kubernetes.io/os&quot;:&quot;linux&quot;},&quot;restartPolicy&quot;:&quot;Always&quot;,&quot;schedulerName&quot;:&quot;default-scheduler&quot;,&quot;securityContext&quot;:{},&quot;serviceAccount&quot;:&quot;local-path-provisioner-service-account&quot;,&quot;serviceAccountName&quot;:&quot;local-path-provisioner-service-account&quot;,&quot;terminationGracePeriodSeconds&quot;:30,&quot;tolerations&quot;:[{&quot;effect&quot;:&quot;NoSchedule&quot;,&quot;key&quot;:&quot;node-role.kubernetes.io/control-plane&quot;,&quot;operator&quot;:&quot;Equal&quot;},{&quot;effect&quot;:&quot;NoSchedule&quot;,&quot;key&quot;:&quot;node-role.kubernetes.io/master&quot;,&quot;operator&quot;:&quot;Equal&quot;}],&quot;volumes&quot;:[{&quot;configMap&quot;:{&quot;defaultMode&quot;:420,&quot;name&quot;:&quot;local-path-config&quot;},&quot;name&quot;:&quot;config-volume&quot;}]}}},&quot;status&quot;:{&quot;availableReplicas&quot;:1,&quot;conditions&quot;:[{&quot;lastTransitionTime&quot;:&quot;2023-11-27T03:31:28Z&quot;,&quot;lastUpdateTime&quot;:&quot;2023-11-27T03:31:28Z&quot;,&quot;message&quot;:&quot;Deployment has minimum availability.&quot;,&quot;reason&quot;:&quot;MinimumReplicasAvailable&quot;,&quot;status&quot;:&quot;True&quot;,&quot;type&quot;:&quot;Available&quot;},{&quot;lastTransitionTime&quot;:&quot;2023-11-27T03:31:24Z&quot;,&quot;lastUpdateTime&quot;:&quot;2023-11-27T03:31:28Z&quot;,&quot;message&quot;:&quot;ReplicaSet &quot;local-path-provisioner-6bc4bddd6b&quot; has successfully progressed.&quot;,&quot;reason&quot;:&quot;NewReplicaSetAvailable&quot;,&quot;status&quot;:&quot;True&quot;,&quot;type&quot;:&quot;Progressing&quot;}],&quot;observedGeneration&quot;:1,&quot;readyReplicas&quot;:1,&quot;replicas&quot;:1,&quot;updatedReplicas&quot;:1}}</td><td>2023-11-27 11:31:11+08:00</td><td>2023-11-27 13:49:39.994794+08:00</td><td></td></tr></tbody></table><p>到这里就结束啦！</p><h2 id="错误排查" tabindex="-1">错误排查 <a class="header-anchor" href="#错误排查" aria-label="Permalink to &quot;错误排查&quot;">​</a></h2><h3 id="在启动-clustersynchro-manager-的时候遭遇了报错-error-initially-creating-leader-election-record-namespaces-clusterpedia-system-not-found" tabindex="-1">在启动 <code>clustersynchro-manager</code> 的时候遭遇了报错 <code>error initially creating leader election record: namespaces &quot;clusterpedia-system&quot; not found</code> <a class="header-anchor" href="#在启动-clustersynchro-manager-的时候遭遇了报错-error-initially-creating-leader-election-record-namespaces-clusterpedia-system-not-found" aria-label="Permalink to &quot;在启动 `clustersynchro-manager` 的时候遭遇了报错 `error initially creating leader election record: namespaces &quot;clusterpedia-system&quot; not found`&quot;">​</a></h3>',15),R=s("code",null,"clusterpedia-system",-1),x=s("h2",{id:"贡献者",tabindex:"-1"},[i("贡献者 "),s("a",{class:"header-anchor",href:"#贡献者","aria-label":'Permalink to "贡献者"'},"​")],-1),N=s("h2",{id:"文件历史",tabindex:"-1"},[i("文件历史 "),s("a",{class:"header-anchor",href:"#文件历史","aria-label":'Permalink to "文件历史"'},"​")],-1);function w(V,I,M,L,Z,U){const o=n("NolebasePageProperties"),a=n("VPNolebaseInlineLinkPreview"),p=n("NolebaseGitContributors"),h=n("NolebaseGitChangelog");return u(),r("div",null,[y,t(o),C,F,s("p",null,[i("根据文档 "),t(a,{href:"https://github.com/kubernetes/sample-apiserver#running-it-stand-alone",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("kubernetes/sample-apiserver: Reference implementation of an apiserver for a custom Kubernetes API.")]),_:1}),i(" 来做一些本地的 Clusterpedia API Server 启动前的准备：")]),m,s("p",null,[i("首先我们需要把我们在"),t(a,{href:"#准备-apiserver-之后通信的时候使用的-mtls-证书"},{default:e(()=>[i("准备 apiserver 之后通信的时候使用的 mTLS 证书")]),_:1}),i("步骤中的 P12 证书包配置到 Postman 中。")]),v,A,b,E,s("ul",null,[f,s("li",null,[i("Passphrase 需要填写我们在"),t(a,{href:"#准备-apiserver-之后通信的时候使用的-mtls-证书"},{default:e(()=>[i("准备 apiserver 之后通信的时候使用的 mTLS 证书")]),_:1}),i("步骤中给 "),B,i(" 传递的参数 "),_,i(" 的 "),D,i(" 字面量。")])]),P,s("p",null,[i("有关 "),T,i(" 的更多信息，可以到 "),t(a,{href:"https://clusterpedia.io/docs/usage/sync-resources/",target:"_blank",rel:"noreferrer"},{default:e(()=>[i("Synchronize Cluster Resources | Clusterpedia.io")]),_:1}),i(" 文档中阅读了解。")]),S,s("p",null,[i("请确保你完成了"),t(a,{href:"./在希望测试的集群中创建-namespace.html"},{default:e(()=>[i("在希望测试的集群中创建 Namespace")]),_:1}),i(" 步骤中对 "),R,i(" Namespace 的创建。")]),x,t(p),N,t(h)])}const z=k(g,[["render",w]]);export{j as __pageData,z as default};
