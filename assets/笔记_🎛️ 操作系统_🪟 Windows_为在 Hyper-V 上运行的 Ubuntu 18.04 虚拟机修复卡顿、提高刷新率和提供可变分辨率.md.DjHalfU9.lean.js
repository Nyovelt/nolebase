import{_ as h,c as p,J as t,m as e,a as s,w as o,V as a,E as r,o as c}from"./chunks/framework.WH0rnJL5.js";const d="/assets/hyper-v-ubuntu-lag-and-resolutions-fixes-screenshot01.iO35hQcO.png",f="/assets/hyper-v-ubuntu-lag-and-resolutions-fixes-screenshot02.HyMaENax.png",_="/assets/hyper-v-ubuntu-lag-and-resolutions-fixes-screenshot03.71hwRy-T.png",b="/assets/hyper-v-ubuntu-lag-and-resolutions-fixes-screenshot04.uTbC5GF4.png",me=JSON.parse('{"title":"为在 Hyper-V 上运行的 Ubuntu 18.04 虚拟机修复卡顿、提高刷新率和提供可变分辨率","description":"","frontmatter":{"tags":["操作系统/Windows","操作系统/Ubuntu","知识领域/计算机图形学","课程/GAMES101","命令行/apt","命令行/scoope","命令行/vim","命令行/Powershell","命令行/wget","命令行/chmod","操作系统/Windows-Server","命令行/vbmanage","软件/虚拟机/VirtualBox","软件/虚拟机/Hyper-V","计算机/计算机科学/CS/虚拟化","开源/库/opencv","开发/虚拟化","开发/语言/Python","开发/语言/Python/Python2","计算机/CPU-指令集/arm64","计算机/硬件/芯片/Apple-Silicon","计算机/硬件/芯片/Apple-Silicon/M1"]},"headers":[],"relativePath":"笔记/🎛️ 操作系统/🪟 Windows/为在 Hyper-V 上运行的 Ubuntu 18.04 虚拟机修复卡顿、提高刷新率和提供可变分辨率.md","filePath":"笔记/🎛️ 操作系统/🪟 Windows/为在 Hyper-V 上运行的 Ubuntu 18.04 虚拟机修复卡顿、提高刷新率和提供可变分辨率.md"}'),k={name:"笔记/🎛️ 操作系统/🪟 Windows/为在 Hyper-V 上运行的 Ubuntu 18.04 虚拟机修复卡顿、提高刷新率和提供可变分辨率.md"},g=e("h1",{id:"为在-hyper-v-上运行的-ubuntu-18-04-虚拟机修复卡顿、提高刷新率和提供可变分辨率",tabindex:"-1"},[s("为在 Hyper-V 上运行的 Ubuntu 18.04 虚拟机修复卡顿、提高刷新率和提供可变分辨率 "),e("a",{class:"header-anchor",href:"#为在-hyper-v-上运行的-ubuntu-18-04-虚拟机修复卡顿、提高刷新率和提供可变分辨率","aria-label":'Permalink to "为在 Hyper-V 上运行的 Ubuntu 18.04 虚拟机修复卡顿、提高刷新率和提供可变分辨率"'},"​")],-1),m=a("",3),v=e("sup",{class:"footnote-ref"},[e("a",{href:"#fn1",id:"fnref1"},"[1]")],-1),y=e("sup",{class:"footnote-ref"},[e("a",{href:"#fn2",id:"fnref2"},"[2]")],-1),w=a("",3),V=e("sup",{class:"footnote-ref"},[e("a",{href:"#fn3",id:"fnref3"},"[3]")],-1),C=e("code",null,"apt",-1),S=a("",6),x=a("",4),U=e("sup",{class:"footnote-ref"},[e("a",{href:"#fn8",id:"fnref8"},"[8]")],-1),H=e("h4",{id:"激活-enhanced-session-mode-增强会话模式",tabindex:"-1"},[s("激活 Enhanced Session Mode 增强会话模式 "),e("a",{class:"header-anchor",href:"#激活-enhanced-session-mode-增强会话模式","aria-label":'Permalink to "激活 Enhanced Session Mode 增强会话模式"'},"​")],-1),A=e("sup",{class:"footnote-ref"},[e("a",{href:"#fn9",id:"fnref9"},"[9]")],-1),E=a("",6),F=e("code",null,"wget",-1),T=a("",16),B=e("code",null,"xorgxrdp-hwe-18.04",-1),P=a("",4),M=e("li",null,"如果你配置完 Hyper-V 的增强模式策略之后还是没有效果的话，不妨试着重启一下 Hyper-V 本体或者 Windows Server 来试图修复问题。",-1),I=e("code",null,"xorgxrdp-hwe-18.04",-1),D=e("h2",{id:"延伸阅读",tabindex:"-1"},[s("延伸阅读 "),e("a",{class:"header-anchor",href:"#延伸阅读","aria-label":'Permalink to "延伸阅读"'},"​")],-1),q=e("h2",{id:"贡献者",tabindex:"-1"},[s("贡献者 "),e("a",{class:"header-anchor",href:"#贡献者","aria-label":'Permalink to "贡献者"'},"​")],-1),N=e("h2",{id:"文件历史",tabindex:"-1"},[s("文件历史 "),e("a",{class:"header-anchor",href:"#文件历史","aria-label":'Permalink to "文件历史"'},"​")],-1),G=e("hr",{class:"footnotes-sep"},null,-1),R={class:"footnotes"},L={class:"footnotes-list"},W={id:"fn1",class:"footnote-item"},O=e("a",{href:"#fnref1",class:"footnote-backref"},"↩︎",-1),z={id:"fn2",class:"footnote-item"},X=e("a",{href:"#fnref2",class:"footnote-backref"},"↩︎",-1),$={id:"fn3",class:"footnote-item"},j=e("a",{href:"#fnref3",class:"footnote-backref"},"↩︎",-1),J={id:"fn4",class:"footnote-item"},Q=e("a",{href:"#fnref4",class:"footnote-backref"},"↩︎",-1),K={id:"fn5",class:"footnote-item"},Y=e("a",{href:"#fnref5",class:"footnote-backref"},"↩︎",-1),Z={id:"fn6",class:"footnote-item"},ee=e("a",{href:"#fnref6",class:"footnote-backref"},"↩︎",-1),se={id:"fn7",class:"footnote-item"},te=e("a",{href:"#fnref7",class:"footnote-backref"},"↩︎",-1),ne={id:"fn8",class:"footnote-item"},oe=e("a",{href:"#fnref8",class:"footnote-backref"},"↩︎",-1),ae={id:"fn9",class:"footnote-item"},re=e("a",{href:"#fnref9",class:"footnote-backref"},"↩︎",-1),ie={id:"fn10",class:"footnote-item"},le=e("a",{href:"#fnref10",class:"footnote-backref"},"↩︎",-1),ue={id:"fn11",class:"footnote-item"},he=e("a",{href:"#fnref11",class:"footnote-backref"},"↩︎",-1);function pe(ce,de,fe,_e,be,ke){const i=r("NolebasePageProperties"),n=r("VPNolebaseInlineLinkPreview"),l=r("NolebaseGitContributors"),u=r("NolebaseGitChangelog");return c(),p("div",null,[g,t(i),m,e("p",null,[s("昨天开始帮小音 @LittleSound 在家里的 Homelab 上配置 "),t(n,{href:"https://games-cn.org/intro-graphics/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("GAMES101 课程")]),_:1}),s("需要用到的 Ubuntu 虚拟机环境（因为 opencv@2 在小音所使用的 Apple Silicon macOS 上不再被支持"),v,s("，而且上游有 python2.7 的引用"),y,s("，更别提，其实在这片文档撰写的时候，python2 已经离我们远去好几年了），配置的时候就发现了好几个问题：")]),w,e("p",null,[s("受限，幸运的是，这似乎是一个已知的 Linux Bug，在通用的 5.4 kernel Ubuntu-5.4.0-66.74 和 HWE kernel Ubuntu-hwe-5.8-5.8.0-44.50_20.04.1 中已经把这个问题修复了"),V,s("，但是这个修复似乎只有 20.04 有，那么 18.04 如果要修复的话要么装 patch 进行更新，要么修改一些配置，但是目前我担心运行 "),C,s(" 相关的命令会导致预先准备的虚拟环境出现不兼容的问题，滚挂掉的话又是另一个故事了，所以我希望现在先在这里寻找一个可能的修复尝试一下。在 "),t(n,{href:"https://github.com/LIS/lis-next/issues/655",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Very slow framebuffer with hyperv_fb on recent Windows hosts, especially in Gen2 VM · Issue #655 · LIS/lis-next")]),_:1}),s(" 这篇 Issue 中有详细提及到这个 Bug 的复现和细节，其中有人给出了如下的解决方案：")]),S,e("p",null,[s("不过，如果你真的想要尝试亲自将 Ubuntu 的 Gen 1 虚拟机迁移到 Gen 2 的话，不妨参考一下这篇回答中的步骤："),t(n,{href:"https://serverfault.com/a/1047507",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Convert Hyper-V linux machine to Gen 2 - Server Fault")]),_:1})]),x,e("p",null,[s("偶然间我看到了其中一个回答提及到了 XRDP 和 Windows Hyper-V 的特殊功能「Enhanced Session 增强会话」"),U,s("，会不会和这个有关？ 巧的是，我也找到了 "),t(n,{href:"https://www.nakivo.com/blog/install-ubuntu-20-04-on-hyper-v-with-enhanced-session/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("How to Enable Hyper-V Enhanced Session for Ubuntu 20.04 VMs")]),_:1}),s(" 这篇文章有讲解如何为 Ubuntu 添加 Hyper-V「Enhanced Session」支持，也确实可以通过这个方法来为 Ubuntu 支持可变分辨率。")]),H,e("p",null,[s("受限我们需要根据这篇 "),t(n,{href:"https://learn.microsoft.com/en-us/windows-server/virtualization/hyper-v/learn-more/use-local-resources-on-hyper-v-virtual-machine-with-vmconnect",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Microsoft 官方文档")]),_:1}),s("的指南，在 Hyper-V 的「Enhanced Session Mode Policy 增强会话模式策略」配置中勾选并激活「Enhanced Session Mode 增强会话模式」。 当然你也可以通过在 Windows Server 上的 PowerShell 以管理员权限运行下面的命令来激活「增强会话模式」"),A,s("：")]),E,e("p",null,[s("在 "),t(n,{href:"https://www.nakivo.com/blog/install-ubuntu-20-04-on-hyper-v-with-enhanced-session/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("How to Enable Hyper-V Enhanced Session for Ubuntu 20.04 VMs")]),_:1}),s(" 这篇文章里还提到了需要为 Ubuntu 执行一个来自于 "),t(n,{href:"https://github.com/Hinara/linux-vm-tools",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Hinara/linux-vm-tools")]),_:1}),s(" 仓库的 Ubuntu 安装脚本，通过这个脚本，将会为我们的 VM 安装包括先前提到的 XRDP 等工具以支持更好的远程操作和虚拟显示屏功能。另外需要注意的是，这个安装脚本 Fork 自 Microsoft 官方的 "),t(n,{href:"https://github.com/microsoft/linux-vm-tools",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("microsoft/linux-vm-tools")]),_:1}),s(" Hyper-V Linux 访客 VM 增强脚本库，不过 Microsoft 官方的脚本仓库似乎已经公开存档了，不再更新，而来自 "),t(n,{href:"https://github.com/Hinara/linux-vm-tools",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Hinara/linux-vm-tools")]),_:1}),s(" 的脚本仓库还为更新版本的 Ubuntu 和 Arch Linux 等发行版提供了更新版本的脚本维护和支持，所以我们跟随原本的文章的指引，在 "),t(n,{href:"https://github.com/Hinara/linux-vm-tools",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Hinara/linux-vm-tools")]),_:1}),s(" 找到并下载对应的 Ubuntu 版本的安装脚本来安装必要的驱动和增强功能就好。")]),e("p",null,[s("我创建的 Ubuntu 系统版本是 18.04，所以对应的下载目录应该在 "),t(n,{href:"https://github.com/Hinara/linux-vm-tools/tree/ubuntu20-04/ubuntu/18.04",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("linux-vm-tools/ubuntu/18.04")]),_:1}),s(" ，通过 "),F,s(" 命令下载原始文件就好：")]),T,e("p",null,[s("这个时候不用慌张，可能是我们的 HWE 内核模块尚不齐全导致的，根据 "),t(n,{href:"https://askubuntu.com/a/1177338",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("18.04 - Remote Desktop -- blue screen after login - Ask Ubuntu")]),_:1}),s(" 这篇回答中的提示，我们只需要安装一下 Ubuntu 18.04 专有的 "),B,s(" 包（其他版本尚不清楚，我比较少用 Ubuntu，没怎么调查过，如果你是其他版本的 Ubuntu 的话不妨自己搜索和排查看看）就能修复了：")]),P,e("ul",null,[M,e("li",null,[s("如果安装完 "),I,s(" 包还是无法正常看到画面的话，不妨参考一下这些回答： "),e("ul",null,[e("li",null,[s("这篇回答中提及到了不少 Hyper-V 专属的包和驱动项目，也许可以参考参考 "),t(n,{href:"https://superuser.com/questions/1267645/how-can-i-run-a-ubuntu-hyper-v-vm-in-full-screen-mode-incl-copy-between-host-an",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("linux - How can I run a Ubuntu Hyper-V vm in full screen mode incl. copy between host and vm? - Super User")]),_:1})]),e("li",null,[t(n,{href:"https://askubuntu.com/a/1404412",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Remote Desktop from Windows onto Ubuntu 22.04 takes me to a XRDP login then a blank screen - Ask Ubuntu")]),_:1})]),e("li",null,[t(n,{href:"https://askubuntu.com/questions/1166568/remote-desktop-blue-screen-after-login",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("18.04 - Remote Desktop -- blue screen after login - Ask Ubuntu")]),_:1})]),e("li",null,[t(n,{href:"https://askubuntu.com/questions/1296796/cant-connect-to-hyper-v-ubuntu-20-04-vm-after-system-program-problem-detected",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("xrdp - Can't connect to Hyper-V Ubuntu 20.04 VM after system program problem detected - Ask Ubuntu")]),_:1})]),e("li",null,[t(n,{href:"https://askubuntu.com/questions/702628/ubuntu-hyper-v-guest-display-resolution-win-10-15-04",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("virtualization - Ubuntu Hyper-V Guest Display Resolution Win 10 + 15.04 - Ask Ubuntu")]),_:1})])])])]),D,e("ul",null,[e("li",null,[t(n,{href:"https://github.com/LIS/lis-next/issues/655",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Very slow framebuffer with hyperv_fb on recent Windows hosts, especially in Gen2 VM · Issue #655 · LIS/lis-next")]),_:1})]),e("li",null,[t(n,{href:"https://askubuntu.com/questions/1263977/ubuntu-on-hyper-v-sluggish-slow-ui-experience",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("windows - Ubuntu on Hyper-V sluggish/slow UI experience - Ask Ubuntu")]),_:1})]),e("li",null,[t(n,{href:"https://4sysops.com/archives/activate-enhanced-session-mode-for-ubuntu-vms-in-hyper-v/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Activate enhanced session mode for Ubuntu VMs in Hyper-V – 4sysops")]),_:1})]),e("li",null,[t(n,{href:"https://petri.com/using-hyper-v-enhanced-session-mode/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Using Hyper-V Enhanced Session Mode")]),_:1})]),e("li",null,[t(n,{href:"https://www.vinchin.com/en/blog/convert-hyper-v-gen-1-to-2.html",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("How to Convert Hyper-V Gen 1 to Gen 2 VM - Vinchin Backup")]),_:1})]),e("li",null,[t(n,{href:"https://4sysops.com/archives/convert-hyper-v-virtual-machines-from-generation-1-to-2/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Convert Hyper-V virtual machines from generation 1 to 2 – 4sysops")]),_:1})]),e("li",null,[t(n,{href:"https://serverfault.com/questions/654828/convert-hyper-v-linux-machine-to-gen-2",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Convert Hyper-V linux machine to Gen 2 - Server Fault")]),_:1})]),e("li",null,[t(n,{href:"https://gist.github.com/bitchelov/0e29a0f706424a2f02716e62be3b12dc",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("[How to] Change Screen Resolution on Ubuntu 18.04 in Hyper-V VM")]),_:1})]),e("li",null,[t(n,{href:"https://askubuntu.com/questions/1030276/ubuntu-server-18-04-lts-cannot-change-resolution-in-hyper-v",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("virtualization - Ubuntu Server 18.04 LTS cannot change resolution in Hyper-V - Ask Ubuntu")]),_:1})]),e("li",null,[t(n,{href:"https://superuser.com/questions/1660150/change-screen-resolution-of-ubuntu-vm-in-hyper-v",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("virtual machine - Change screen resolution of Ubuntu VM in Hyper-V - Super User")]),_:1})]),e("li",null,[t(n,{href:"https://superuser.com/questions/518484/how-can-i-increase-the-hyper-v-display-resolution",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("ubuntu - How can I increase the Hyper-V display resolution? - Super User")]),_:1})]),e("li",null,[t(n,{href:"https://answers.microsoft.com/en-us/windows/forum/all/hyperv-virtual-machine-not-covering-full-screen/79330f73-ac1b-4ad9-9266-ff53842f7dd7",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("HyperV Virtual Machine Not Covering Full-Screen - Ubuntu- Linux - 2022 - Microsoft Community")]),_:1})])]),q,t(l),N,t(u),G,e("section",R,[e("ol",L,[e("li",W,[e("p",null,[t(n,{href:"https://superuser.com/questions/1761181/ffmpeg-with-opencv-4-7-0",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("macos - FFmpeg with opencv 4.7.0? - Super User")]),_:1}),s(),O])]),e("li",z,[e("p",null,[t(n,{href:"https://stackoverflow.com/questions/61779114/how-to-install-opencv-2-4-if-it-is-no-longer-supported",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("python - How to install OpenCV 2.4 if it is no longer supported? - Stack Overflow")]),_:1}),s(),X])]),e("li",$,[e("p",null,[t(n,{href:"https://askubuntu.com/a/1316949",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("windows - Ubuntu on Hyper-V sluggish/slow UI experience - Ask Ubuntu")]),_:1}),s("，在这个问题的其中一个回答中提到：对于 Ubuntu 20.04，作者刚刚检查过，最新的 linux-azure 内核 Ubuntu-azure-5.4.0-1039.41（2021 年 1 月 18 日）仍然没有修复，但通用的 5.4 内核 Ubuntu-5.4.0-66.74 和 HWE 内核 Ubuntu-hwe-5.8-5.8.0-44.50_20.04.1 已经有修复。 "),j])]),e("li",J,[e("p",null,[t(n,{href:"https://learn.microsoft.com/en-us/archive/blogs/virtual_pc_guy/changing-ubuntu-screen-resolution-in-a-hyper-v-vm",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Changing Ubuntu Screen Resolution in a Hyper-V VM | Microsoft Learn")]),_:1}),s(),Q])]),e("li",K,[e("p",null,[t(n,{href:"https://superuser.com/questions/518484/how-can-i-increase-the-hyper-v-display-resolution",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("ubuntu - How can I increase the Hyper-V display resolution? - Super User")]),_:1}),s(),Y])]),e("li",Z,[e("p",null,[t(n,{href:"https://superuser.com/questions/1660150/change-screen-resolution-of-ubuntu-vm-in-hyper-v",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("virtual machine - Change screen resolution of Ubuntu VM in Hyper-V - Super User")]),_:1}),s(),ee])]),e("li",se,[e("p",null,[t(n,{href:"https://arcanecode.com/2020/12/28/adjust-the-screen-resolution-of-an-ubuntu-hyper-v-virtual-machine/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Adjust the Screen Resolution of an Ubuntu Hyper-V Virtual Machine – Arcane Code")]),_:1}),s(),te])]),e("li",ne,[e("p",null,[t(n,{href:"https://superuser.com/a/1769324",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("linux - How can I run a Ubuntu Hyper-V vm in full screen mode incl. copy between host and vm? - Super User")]),_:1}),s(),oe])]),e("li",ae,[e("p",null,[t(n,{href:"https://learn.microsoft.com/en-us/powershell/module/hyper-v/set-vmhost?view=windowsserver2022-ps#-enableenhancedsessionmode",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Set-VMHost (Hyper-V) | Microsoft Learn")]),_:1}),s(),re])]),e("li",ie,[e("p",null,[t(n,{href:"https://learn.microsoft.com/en-us/answers/questions/138093/hyper-v-advanced-session-doesnt-work?childtoview=319218&orderby=newest",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Hyper-V advanced session doesn't work - Microsoft Q&A")]),_:1}),s(),le])]),e("li",ue,[e("p",null,[t(n,{href:"https://www.nakivo.com/blog/install-ubuntu-20-04-on-hyper-v-with-enhanced-session/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("How to Enable Hyper-V Enhanced Session for Ubuntu 20.04 VMs")]),_:1}),s(),he])])])])])}const ve=h(k,[["render",pe]]);export{me as __pageData,ve as default};
