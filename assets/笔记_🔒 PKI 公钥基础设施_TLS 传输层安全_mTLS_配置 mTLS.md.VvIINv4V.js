import{_ as k,c as r,J as a,m as s,a as i,w as n,V as d,E as t,o}from"./chunks/framework.WH0rnJL5.js";const x=JSON.parse('{"title":"é…ç½® mTLS","description":"","frontmatter":{"tags":["è®¡ç®—æœº/ç½‘ç»œ/ç½‘å…³/Nginx","æ•°å­¦/å¯†ç å­¦/è¯ä¹¦/TLS/SSL","æ•°å­¦/å¯†ç å­¦/è¯ä¹¦/TLS","æ•°å­¦/å¯†ç å­¦/è¯ä¹¦/è¯ä¹¦æœºæ„","æ•°å­¦/å¯†ç å­¦/è¯ä¹¦/è¯ä¹¦æœºæ„/CA","æ•°å­¦/å¯†ç å­¦/è¯ä¹¦/p12","è®¡ç®—æœº/ä¿¡æ¯æŠ€æœ¯/å®‰å…¨/ç½‘ç»œå®‰å…¨/ZTNA","è®¡ç®—æœº/ä¿¡æ¯æŠ€æœ¯/å®‰å…¨/æ“ä½œç³»ç»Ÿå®‰å…¨/KeyStore","æ•°å­¦/å¯†ç å­¦/è¯ä¹¦/PKI","å‘½ä»¤è¡Œ/openssl","æ•°å­¦/å¯†ç å­¦/è¯ä¹¦/TLS/mTLS"]},"headers":[],"relativePath":"ç¬”è®°/ğŸ”’ PKI å…¬é’¥åŸºç¡€è®¾æ–½/TLS ä¼ è¾“å±‚å®‰å…¨/mTLS/é…ç½® mTLS.md","filePath":"ç¬”è®°/ğŸ”’ PKI å…¬é’¥åŸºç¡€è®¾æ–½/TLS ä¼ è¾“å±‚å®‰å…¨/mTLS/é…ç½® mTLS.md"}'),c={name:"ç¬”è®°/ğŸ”’ PKI å…¬é’¥åŸºç¡€è®¾æ–½/TLS ä¼ è¾“å±‚å®‰å…¨/mTLS/é…ç½® mTLS.md"},g=s("h1",{id:"é…ç½®-mtls",tabindex:"-1"},[i("é…ç½® mTLS "),s("a",{class:"header-anchor",href:"#é…ç½®-mtls","aria-label":'Permalink to "é…ç½® mTLS"'},"â€‹")],-1),y=d(`<h2 id="åˆ›å»º-ca-è¯ä¹¦é¢å‘æœºæ„" tabindex="-1">åˆ›å»º CAï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰ <a class="header-anchor" href="#åˆ›å»º-ca-è¯ä¹¦é¢å‘æœºæ„" aria-label="Permalink to &quot;åˆ›å»º CAï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰&quot;">â€‹</a></h2><h3 id="åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„ç§é’¥å¹¶ä½¿ç”¨-des3-åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯†" tabindex="-1">åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„ç§é’¥å¹¶ä½¿ç”¨ des3 åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯† <a class="header-anchor" href="#åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„ç§é’¥å¹¶ä½¿ç”¨-des3-åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯†" aria-label="Permalink to &quot;åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„ç§é’¥å¹¶ä½¿ç”¨ des3 åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯†&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> genrsa -des3 -out ca.pem </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4096</span></span></code></pre></div><h3 id="åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦ç”³è¯·" tabindex="-1">åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦ç”³è¯· <a class="header-anchor" href="#åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦ç”³è¯·" aria-label="Permalink to &quot;åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦ç”³è¯·&quot;">â€‹</a></h3><p>æ­¤å¤„ç”³è¯·äº† 18250 å¤©ï¼ˆ50 å¹´ï¼‰çš„æ ¹è¯ä¹¦</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> req -x509 -new -nodes -key ca.pem -sha256 -days </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">18250</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -out ca.crt</span></span></code></pre></div><h4 id="å¡«å†™å­—æ®µå€¼" tabindex="-1">å¡«å†™å­—æ®µå€¼ <a class="header-anchor" href="#å¡«å†™å­—æ®µå€¼" aria-label="Permalink to &quot;å¡«å†™å­—æ®µå€¼&quot;">â€‹</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pass phrase for myCA.key:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">You</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> are about to be asked to enter information that will be incorporated</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">into</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your certificate request.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">What</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> you are about to enter is what is called a Distinguished Name or a DN.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">There</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> are quite a few fields but you can leave some blank</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">For</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> some fields there will be a default value,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">If</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> you enter &#39;.&#39;, the field will be left blank.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-----</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Country</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> letter code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) [AU]: CN </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># å›½å®¶ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">State</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> or Province Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">full</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) [Some-State]: Shanghai </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># çœä»½/å·åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">State</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Locality Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> city</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) []: Shanghai </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ‰€åœ¨åŸå¸‚åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Organization</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> company</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) [Internet </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Widgits Pty Ltd]: Ayaka iHome # æ­¤å¤„è¾“å…¥ç»„ç»‡åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Organizational</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Unit Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> section</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) []: Home </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ­¤å¤„è¾“å…¥éƒ¨é—¨åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Common</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">e.g.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server FQDN or YOUR name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) []: Ayaka iHome Root CA </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ­¤å¤„è¾“å…¥è¯ä¹¦åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Email</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Address []:neko@ayaka.moe # æ­¤å¤„è¾“å…¥ Root CA ç®¡ç†å‘˜ç”µå­é‚®ç®±</span></span></code></pre></div><h3 id="åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„é…ç½®æ–‡ä»¶å¹¶å†™å…¥ç­–ç•¥å’Œæ‹“å±•ä¿¡æ¯" tabindex="-1">åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„é…ç½®æ–‡ä»¶å¹¶å†™å…¥ç­–ç•¥å’Œæ‹“å±•ä¿¡æ¯ <a class="header-anchor" href="#åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„é…ç½®æ–‡ä»¶å¹¶å†™å…¥ç­–ç•¥å’Œæ‹“å±•ä¿¡æ¯" aria-label="Permalink to &quot;åˆ›å»ºæ ¹è¯ä¹¦é¢å‘æœºæ„çš„é…ç½®æ–‡ä»¶å¹¶å†™å…¥ç­–ç•¥å’Œæ‹“å±•ä¿¡æ¯&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;[ ca ]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"># \`man ca\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">default_ca = CA_default</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">[ CA_default ]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">dir           = /Users/neko/certs/home</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">private_key   = $dir/home_ca.pem</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">certificate   = $dir/home_ca.crt</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">database      = $dir/index.txt</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">new_certs_dir = $dir/certs</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">serial        = $dir/serial</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">policy        = policy_loose</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">[ policy_loose ]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">countryName             = optional</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">stateOrProvinceName     = optional</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">localityName            = optional</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">organizationName        = optional</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">organizationalUnitName  = optional</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">commonName              = supplied</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">emailAddress            = optional</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">[ v3_intermediate_ca ]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"># Extensions for a typical intermediate CA (\`man x509v3_config\`).</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">subjectKeyIdentifier = hash</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">authorityKeyIdentifier = keyid:always,issuer</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">basicConstraints = critical, CA:true, pathlen:0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">keyUsage = critical, digitalSignature, cRLSign, keyCertSign</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./home_ca.cnf</span></span></code></pre></div><h2 id="åˆ›å»º-intermediate-ca-ä¸­é—´è¯ä¹¦é¢å‘æœºæ„" tabindex="-1">åˆ›å»º Intermediate CAï¼ˆä¸­é—´è¯ä¹¦é¢å‘æœºæ„ï¼‰ <a class="header-anchor" href="#åˆ›å»º-intermediate-ca-ä¸­é—´è¯ä¹¦é¢å‘æœºæ„" aria-label="Permalink to &quot;åˆ›å»º Intermediate CAï¼ˆä¸­é—´è¯ä¹¦é¢å‘æœºæ„ï¼‰&quot;">â€‹</a></h2><h3 id="åˆ›å»ºä¸­é—´è¯ä¹¦é¢å‘æœºæ„çš„ç§é’¥å¹¶ä½¿ç”¨-des3-åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯†" tabindex="-1">åˆ›å»ºä¸­é—´è¯ä¹¦é¢å‘æœºæ„çš„ç§é’¥å¹¶ä½¿ç”¨ des3 åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯† <a class="header-anchor" href="#åˆ›å»ºä¸­é—´è¯ä¹¦é¢å‘æœºæ„çš„ç§é’¥å¹¶ä½¿ç”¨-des3-åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯†" aria-label="Permalink to &quot;åˆ›å»ºä¸­é—´è¯ä¹¦é¢å‘æœºæ„çš„ç§é’¥å¹¶ä½¿ç”¨ des3 åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯†&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> genrsa -des3 -out intermediates/home_ca_intermediate_1.pem </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4096</span></span></code></pre></div><h3 id="åˆ›å»ºä¸­é—´è¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦ç”³è¯·" tabindex="-1">åˆ›å»ºä¸­é—´è¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦ç”³è¯· <a class="header-anchor" href="#åˆ›å»ºä¸­é—´è¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦ç”³è¯·" aria-label="Permalink to &quot;åˆ›å»ºä¸­é—´è¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦ç”³è¯·&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> req -new -sha256 -key intermediates/home_ca_intermediate_1.pem -out intermediates/home_ca_intermediate_1.csr</span></span></code></pre></div><h3 id="ä½¿ç”¨æ ¹è¯ä¹¦é¢å‘æœºæ„å¯¹ä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¿›è¡Œç­¾å‘" tabindex="-1">ä½¿ç”¨æ ¹è¯ä¹¦é¢å‘æœºæ„å¯¹ä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¿›è¡Œç­¾å‘ <a class="header-anchor" href="#ä½¿ç”¨æ ¹è¯ä¹¦é¢å‘æœºæ„å¯¹ä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¿›è¡Œç­¾å‘" aria-label="Permalink to &quot;ä½¿ç”¨æ ¹è¯ä¹¦é¢å‘æœºæ„å¯¹ä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¿›è¡Œç­¾å‘&quot;">â€‹</a></h3><p>æ­¤å¤„ä½¿ç”¨äº†å…ˆå‰åˆ›å»ºå¹¶å†™å…¥çš„ <code>home_ca.cnf</code> é…ç½®æ–‡ä»¶ï¼Œå¼€å¯äº†é…ç½®æ–‡ä»¶ä¸­å†™å…¥çš„ <code>v3_intermediate_ca</code> æ‹“å±•</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ca -config home_ca.cnf -extensions v3_intermediate_ca -days </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3650</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -notext -md sha256 -in intermediates/home_ca_intermediate_1.csr -out intermediates/home_ca_intermediate_1.crt</span></span></code></pre></div><h3 id="ä½¿ç”¨æ ¹è¯ä¹¦é¢å‘æœºæ„å¯¹ä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¿›è¡ŒéªŒè¯æµ‹è¯•" tabindex="-1">ä½¿ç”¨æ ¹è¯ä¹¦é¢å‘æœºæ„å¯¹ä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¿›è¡ŒéªŒè¯æµ‹è¯• <a class="header-anchor" href="#ä½¿ç”¨æ ¹è¯ä¹¦é¢å‘æœºæ„å¯¹ä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¿›è¡ŒéªŒè¯æµ‹è¯•" aria-label="Permalink to &quot;ä½¿ç”¨æ ¹è¯ä¹¦é¢å‘æœºæ„å¯¹ä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¿›è¡ŒéªŒè¯æµ‹è¯•&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> verify -CAfile home_ca.crt intermediates/home_ca_intermediate_1.crt</span></span></code></pre></div><p>åº”è¯¥è¾“å‡º</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">intermediates/home_ca_intermediate_1.crt:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> OK</span></span></code></pre></div><h2 id="åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦" tabindex="-1">åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ <a class="header-anchor" href="#åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦" aria-label="Permalink to &quot;åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦&quot;">â€‹</a></h2><h3 id="åˆ›å»ºå®¢æˆ·ç«¯ç”¨æˆ·çš„ç§é’¥å¹¶ä½¿ç”¨-des3-åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯†" tabindex="-1">åˆ›å»ºå®¢æˆ·ç«¯ç”¨æˆ·çš„ç§é’¥å¹¶ä½¿ç”¨ des3 åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯† <a class="header-anchor" href="#åˆ›å»ºå®¢æˆ·ç«¯ç”¨æˆ·çš„ç§é’¥å¹¶ä½¿ç”¨-des3-åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯†" aria-label="Permalink to &quot;åˆ›å»ºå®¢æˆ·ç«¯ç”¨æˆ·çš„ç§é’¥å¹¶ä½¿ç”¨ des3 åŠ å¯†æ¨¡å¼è¿›è¡ŒåŠ å¯†&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> genrsa -des3 -out clients/neko.pem </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4096</span></span></code></pre></div><h3 id="åˆ›å»ºè¯ä¹¦ç”³è¯·" tabindex="-1">åˆ›å»ºè¯ä¹¦ç”³è¯· <a class="header-anchor" href="#åˆ›å»ºè¯ä¹¦ç”³è¯·" aria-label="Permalink to &quot;åˆ›å»ºè¯ä¹¦ç”³è¯·&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> req -new -key clients/neko.pem -out clients/neko.csr</span></span></code></pre></div><h4 id="å¡«å†™å­—æ®µå€¼-1" tabindex="-1">å¡«å†™å­—æ®µå€¼ <a class="header-anchor" href="#å¡«å†™å­—æ®µå€¼-1" aria-label="Permalink to &quot;å¡«å†™å­—æ®µå€¼&quot;">â€‹</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pass phrase for clients/neko.pem:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">You</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> are about to be asked to enter information that will be incorporated</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">into</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your certificate request.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">What</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> you are about to enter is what is called a Distinguished Name or a DN.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">There</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> are quite a few fields but you can leave some blank</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">For</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> some fields there will be a default value,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">If</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> you enter &#39;.&#39;, the field will be left blank.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-----</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Country</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> letter code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) []:CN </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># å›½å®¶ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">State</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> or Province Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">full</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) []:Shanghai </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># çœä»½/å·åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Locality</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> city</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) []:Shanghai </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ‰€åœ¨åŸå¸‚åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Organization</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> company</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) []:Ayaka Home Users </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ­¤å¤„è¾“å…¥ç»„ç»‡åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Organizational</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Unit Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> section</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) []:Users </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ­¤å¤„è¾“å…¥éƒ¨é—¨åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Common</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Name </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eg,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fully qualified host name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) []:neko@ayaka.moe </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># æ­¤å¤„è¾“å…¥è¯ä¹¦åç§°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Email</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Address []:neko@ayaka.moe # æ­¤å¤„è¾“å…¥æˆæƒçš„ç”µå­é‚®ç®±è´¦å·</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Please</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> enter the following &#39;extra&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> attributes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> be sent with your certificate request</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> challenge password []:</span></span></code></pre></div><h3 id="é…ç½®è¯ä¹¦ç±»å‹å¹¶ä½¿ç”¨-ca-è¯ä¹¦å’Œç§é’¥è¿›è¡Œè¯ä¹¦ç­¾å‘" tabindex="-1">é…ç½®è¯ä¹¦ç±»å‹å¹¶ä½¿ç”¨ CA è¯ä¹¦å’Œç§é’¥è¿›è¡Œè¯ä¹¦ç­¾å‘ <a class="header-anchor" href="#é…ç½®è¯ä¹¦ç±»å‹å¹¶ä½¿ç”¨-ca-è¯ä¹¦å’Œç§é’¥è¿›è¡Œè¯ä¹¦ç­¾å‘" aria-label="Permalink to &quot;é…ç½®è¯ä¹¦ç±»å‹å¹¶ä½¿ç”¨ CA è¯ä¹¦å’Œç§é’¥è¿›è¡Œè¯ä¹¦ç­¾å‘&quot;">â€‹</a></h3><h4 id="é…ç½®è¯ä¹¦ç±»å‹" tabindex="-1">é…ç½®è¯ä¹¦ç±»å‹ <a class="header-anchor" href="#é…ç½®è¯ä¹¦ç±»å‹" aria-label="Permalink to &quot;é…ç½®è¯ä¹¦ç±»å‹&quot;">â€‹</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;basicConstraints = CA:FALSE</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">nsCertType = client, email</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">nsComment = &quot;Ayaka Home Users Certificates&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">subjectKeyIdentifier = hash</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">authorityKeyIdentifier = keyid,issuer</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">extendedKeyUsage = clientAuth, emailProtection</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> clients/neko.cnf</span></span></code></pre></div><h4 id="è¯ä¹¦ç­¾å‘" tabindex="-1">è¯ä¹¦ç­¾å‘ <a class="header-anchor" href="#è¯ä¹¦ç­¾å‘" aria-label="Permalink to &quot;è¯ä¹¦ç­¾å‘&quot;">â€‹</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> x509 -req -days </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">365</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -sha256 -extfile clients/neko.cnf -in clients/neko.csr -CA home_ca.crt -CAkey home_ca.pem -out clients/neko.crt -CAcreateserial</span></span></code></pre></div><h3 id="åˆ›å»ºè¯ä¹¦é“¾-bundle" tabindex="-1">åˆ›å»ºè¯ä¹¦é“¾ bundle <a class="header-anchor" href="#åˆ›å»ºè¯ä¹¦é“¾-bundle" aria-label="Permalink to &quot;åˆ›å»ºè¯ä¹¦é“¾ bundle&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> home_ca.crt intermediates/home_ca_intermediate_1.crt</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1_bundle.crt</span></span></code></pre></div><h3 id="ä½¿ç”¨è¯ä¹¦é“¾-bundle-æ¥ä¸ºå®¢æˆ·ç«¯è¯ä¹¦è¿›è¡ŒéªŒè¯æµ‹è¯•" tabindex="-1">ä½¿ç”¨è¯ä¹¦é“¾ bundle æ¥ä¸ºå®¢æˆ·ç«¯è¯ä¹¦è¿›è¡ŒéªŒè¯æµ‹è¯• <a class="header-anchor" href="#ä½¿ç”¨è¯ä¹¦é“¾-bundle-æ¥ä¸ºå®¢æˆ·ç«¯è¯ä¹¦è¿›è¡ŒéªŒè¯æµ‹è¯•" aria-label="Permalink to &quot;ä½¿ç”¨è¯ä¹¦é“¾ bundle æ¥ä¸ºå®¢æˆ·ç«¯è¯ä¹¦è¿›è¡ŒéªŒè¯æµ‹è¯•&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> verify -CAfile intermediates/home_ca_intermediate_1_bundle.crt clients/neko.crt</span></span></code></pre></div><p>åº”è¯¥è¾“å‡º</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clients/neko.crt:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> OK</span></span></code></pre></div><h3 id="å°†ç”¨æˆ·è¯ä¹¦æ‰“åŒ…ä¸º-pfx-p12-æ ¼å¼çš„æ–‡ä»¶æ–¹ä¾¿å¯¼å…¥å¯¼å‡º" tabindex="-1">å°†ç”¨æˆ·è¯ä¹¦æ‰“åŒ…ä¸º .pfx/.p12 æ ¼å¼çš„æ–‡ä»¶æ–¹ä¾¿å¯¼å…¥å¯¼å‡º <a class="header-anchor" href="#å°†ç”¨æˆ·è¯ä¹¦æ‰“åŒ…ä¸º-pfx-p12-æ ¼å¼çš„æ–‡ä»¶æ–¹ä¾¿å¯¼å…¥å¯¼å‡º" aria-label="Permalink to &quot;å°†ç”¨æˆ·è¯ä¹¦æ‰“åŒ…ä¸º .pfx/.p12 æ ¼å¼çš„æ–‡ä»¶æ–¹ä¾¿å¯¼å…¥å¯¼å‡º&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pkcs12 -export -out clients/neko.p12 -inkey clients/neko.pem -in clients/neko.crt</span></span></code></pre></div><h2 id="é…ç½®-nginx-è¿›è¡Œ-mtls-éªŒè¯" tabindex="-1">é…ç½® Nginx è¿›è¡Œ mTLS éªŒè¯ <a class="header-anchor" href="#é…ç½®-nginx-è¿›è¡Œ-mtls-éªŒè¯" aria-label="Permalink to &quot;é…ç½® Nginx è¿›è¡Œ mTLS éªŒè¯&quot;">â€‹</a></h2><h3 id="å°†è¯ä¹¦é“¾-bundle-ä¸Šä¼ å¹¶é…ç½®åˆ°-nginx-ç›®å½•ä¸‹" tabindex="-1">å°†è¯ä¹¦é“¾ bundle ä¸Šä¼ å¹¶é…ç½®åˆ° Nginx ç›®å½•ä¸‹ <a class="header-anchor" href="#å°†è¯ä¹¦é“¾-bundle-ä¸Šä¼ å¹¶é…ç½®åˆ°-nginx-ç›®å½•ä¸‹" aria-label="Permalink to &quot;å°†è¯ä¹¦é“¾ bundle ä¸Šä¼ å¹¶é…ç½®åˆ° Nginx ç›®å½•ä¸‹&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">scp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> intermediates/home_ca_intermediate_1.pem host:~/</span></span></code></pre></div><h4 id="åˆ›å»º-client-certs-ç›®å½•" tabindex="-1">åˆ›å»º <code>client_certs</code> ç›®å½• <a class="header-anchor" href="#åˆ›å»º-client-certs-ç›®å½•" aria-label="Permalink to &quot;åˆ›å»º \`client_certs\` ç›®å½•&quot;">â€‹</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mkdir -p /etc/nginx/client_certs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chmod </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">600</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/nginx/client_certs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chmod </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">600</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -R /etc/nginx/client_certs</span></span></code></pre></div><p>ç§»åŠ¨è¯ä¹¦é“¾ bundle åˆ° <code>client_certs</code> ç›®å½•ä¸‹</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mv ~/home_ca_intermediate_1_bundle.crt ./</span></span></code></pre></div><h3 id="æ›´æ–°-nginx-é…ç½®æ–‡ä»¶" tabindex="-1">æ›´æ–° Nginx é…ç½®æ–‡ä»¶ <a class="header-anchor" href="#æ›´æ–°-nginx-é…ç½®æ–‡ä»¶" aria-label="Permalink to &quot;æ›´æ–° Nginx é…ç½®æ–‡ä»¶&quot;">â€‹</a></h3><p>åœ¨éœ€è¦æ·»åŠ  mTLS éªŒè¯çš„æœåŠ¡é…ç½®ä¸­æ·»åŠ ä¸‹é¢çš„å‡ è¡Œ</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # æ·»åŠ  ssl_client_certificate å‚æ•°é…ç½®ï¼Œå¡«å†™ è¯ä¹¦é“¾ bundle çš„è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    ssl_client_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/etc/nginx/client_certs/home_ca_intermediate_1_bundle.crt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # æ·»åŠ  ssl_verify_client å‚æ•°é…ç½®ï¼Œå¡«å†™ä¸º optionalã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # æ³¨ï¼šè¯¥å‚æ•°é…ç½®æ”¯æŒä¸‰ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 1. on: å¼ºåˆ¶ TLS è¯ä¹¦éªŒè¯ï¼Œä¸æ»¡è¶³æ—¶æ‹’ç»è¿æ¥;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 2. optional: ä¸å¼ºåˆ¶ TLS è¯ä¹¦éªŒè¯ï¼Œå°†ç»“æœè¿”å›åˆ° Nginx ä¸Šä¸‹æ–‡ ssl_client_verify å˜é‡ä¸­;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 3. off; å…³é—­ TLS è¯ä¹¦éªŒè¯ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    ssl_verify_client </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">     optional;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        # è¿›è¡Œ if åˆ¤æ–­ï¼Œå¯¹ TLS å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯ç»“æœè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœéªŒè¯ä¸æˆåŠŸï¼Œåˆ™è¿”å› 496 é”™è¯¯ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ($</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ssl_client_verify</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> != </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">SUCCESS) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 496</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="æµ‹è¯•-nginx-é…ç½®æ–‡ä»¶" tabindex="-1">æµ‹è¯• Nginx é…ç½®æ–‡ä»¶ <a class="header-anchor" href="#æµ‹è¯•-nginx-é…ç½®æ–‡ä»¶" aria-label="Permalink to &quot;æµ‹è¯• Nginx é…ç½®æ–‡ä»¶&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx -t</span></span></code></pre></div><h3 id="é‡è½½-nginx-é…ç½®" tabindex="-1">é‡è½½ Nginx é…ç½® <a class="header-anchor" href="#é‡è½½-nginx-é…ç½®" aria-label="Permalink to &quot;é‡è½½ Nginx é…ç½®&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx -s reload</span></span></code></pre></div><h2 id="å‚è€ƒèµ„æ–™" tabindex="-1">å‚è€ƒèµ„æ–™ <a class="header-anchor" href="#å‚è€ƒèµ„æ–™" aria-label="Permalink to &quot;å‚è€ƒèµ„æ–™&quot;">â€‹</a></h2>`,57),F=s("h2",{id:"å»¶ä¼¸é˜…è¯»",tabindex:"-1"},[i("å»¶ä¼¸é˜…è¯» "),s("a",{class:"header-anchor",href:"#å»¶ä¼¸é˜…è¯»","aria-label":'Permalink to "å»¶ä¼¸é˜…è¯»"'},"â€‹")],-1),u=s("h2",{id:"è´¡çŒ®è€…",tabindex:"-1"},[i("è´¡çŒ®è€… "),s("a",{class:"header-anchor",href:"#è´¡çŒ®è€…","aria-label":'Permalink to "è´¡çŒ®è€…"'},"â€‹")],-1),C=s("h2",{id:"æ–‡ä»¶å†å²",tabindex:"-1"},[i("æ–‡ä»¶å†å² "),s("a",{class:"header-anchor",href:"#æ–‡ä»¶å†å²","aria-label":'Permalink to "æ–‡ä»¶å†å²"'},"â€‹")],-1);function m(b,f,A,_,v,E){const l=t("NolebasePageProperties"),e=t("VPNolebaseInlineLinkPreview"),h=t("NolebaseGitContributors"),p=t("NolebaseGitChangelog");return o(),r("div",null,[g,a(l),s("p",null,[i("æœ¬æ–‡ç« ç€é‡å‚è€ƒäº† "),a(e,{href:"https://jamielinux.com/docs/openssl-certificate-authority/introduction.html",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("OpenSSL Certificate Authority â€” Jamie Nguyen")]),_:1}),i(" ä¸€ç«™çš„æ–‡ç« è¯´æ˜å’Œè®²è§£ã€‚")]),y,s("p",null,[a(e,{href:"https://gist.github.com/yidas/af42d2952d85c0951c1722fcd68716c6",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("Certificate(CSR) configuration file")]),_:1})]),s("p",null,[a(e,{href:"https://www.phildev.net/ssl/creating_ca.html",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("Creating a CA")]),_:1})]),s("p",null,[a(e,{href:"https://unix.stackexchange.com/questions/398280/openssl-basic-configuration-new-certs-dir-certs",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("OpenSSL, basic configuration, new_certs_dir, certs - Unix & Linux Stack Exchange")]),_:1})]),s("p",null,[a(e,{href:"https://dadhacks.org/2017/12/27/building-a-root-ca-and-an-intermediate-ca-using-openssl-and-debian-stretch/",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("Building a Root CA and an Intermediate CA using OpenSSL and Debian Stretch | Dad Hacks")]),_:1})]),s("p",null,[a(e,{href:"https://www.jianshu.com/p/b92d4c8cbe05",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("opensslç”Ÿæˆhttpsè‡ªç­¾åè¯ä¹¦ - ç®€ä¹¦")]),_:1})]),s("p",null,[a(e,{href:"https://jamielinux.com/docs/openssl-certificate-authority/create-the-intermediate-pair.html",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("Create the intermediate pair â€” OpenSSL Certificate Authority â€” Jamie Nguyen")]),_:1})]),s("p",null,[a(e,{href:"https://www.golinuxcloud.com/create-certificate-authority-root-ca-linux/",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("Create Certificate Authority and sign a certificate with Root CA | GoLinuxCloud")]),_:1})]),s("p",null,[a(e,{href:"https://www.golinuxcloud.com/openssl-create-client-server-certificate/",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("OpenSSL create client certificate & server certificate with example | GoLinuxCloud")]),_:1})]),s("p",null,[a(e,{href:"https://apfelboymchen.net/gnu/notes/openssl%20multidomain%20with%20config%20files.html",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("How to create multidomain certificates using config files")]),_:1})]),s("p",null,[a(e,{href:"https://smallstep.com/hello-mtls/doc/server/nginx",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("Configuring Your Nginx Server for Mutual TLS â€” Smallstep")]),_:1})]),s("p",null,[a(e,{href:"https://tweenpath.net/convert-p12-bundle-to-server-certificate-and-key-files/",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("Convert .p12 bundle to server certificate and key files | Bots!")]),_:1})]),F,s("p",null,[a(e,{href:"https://smallstep.com/hello-mtls/doc/server/nginx",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("Nginx çš„ç®€å• mTLS é…ç½® - smallstep")]),_:1})]),s("p",null,[a(e,{href:"https://www.nginx.com/blog/mtls-architecture-nginx-service-mesh/",target:"_blank",rel:"noreferrer"},{default:n(()=>[i("Nginx æœåŠ¡ç½‘æ ¼ä¸­çš„ mTLS æ¶æ„ - Nginx")]),_:1})]),u,a(h),C,a(p)])}const q=k(c,[["render",m]]);export{x as __pageData,q as default};
