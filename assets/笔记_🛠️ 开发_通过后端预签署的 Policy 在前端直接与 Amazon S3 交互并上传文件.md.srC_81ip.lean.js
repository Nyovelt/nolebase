import{_ as r,c as d,J as a,m as s,a as i,w as t,V as h,E as l,o}from"./chunks/framework.WH0rnJL5.js";const B="/assets/use-backend-presigned-post-policy-to-upload-files-directly-to-aws-s3-screenshot-3.OomNgFps.png",g="/assets/use-backend-presigned-post-policy-to-upload-files-directly-to-aws-s3-screenshot-1.MIR0CaHS.png",y="/assets/use-backend-presigned-post-policy-to-upload-files-directly-to-aws-s3-screenshot-2.q78fVhjp.png",H=JSON.parse('{"title":"通过后端预签署的 Policy 在前端直接与 Amazon S3 交互并上传文件","description":"","frontmatter":{"tags":["基础设施/云服务商/亚马逊云","基础设施/云服务商/亚马逊云/AWS","基础设施/存储/对象存储/亚马逊云/AWS/S3","开发/后端","开发/前端","计算机/信息技术/安全","开发/Nodejs","开发/Nodejs/pnpm"]},"headers":[],"relativePath":"笔记/🛠️ 开发/通过后端预签署的 Policy 在前端直接与 Amazon S3 交互并上传文件.md","filePath":"笔记/🛠️ 开发/通过后端预签署的 Policy 在前端直接与 Amazon S3 交互并上传文件.md"}'),c={name:"笔记/🛠️ 开发/通过后端预签署的 Policy 在前端直接与 Amazon S3 交互并上传文件.md"},A=s("h1",{id:"通过后端预签署的-policy-在前端直接与-amazon-s3-交互并上传文件",tabindex:"-1"},[i("通过后端预签署的 Policy 在前端直接与 Amazon S3 交互并上传文件 "),s("a",{class:"header-anchor",href:"#通过后端预签署的-policy-在前端直接与-amazon-s3-交互并上传文件","aria-label":'Permalink to "通过后端预签署的 Policy 在前端直接与 Amazon S3 交互并上传文件"'},"​")],-1),E=h("",19),C=h("",16),F=s("code",null,"@aws-sdk/s3-presigned-post",-1),u=s("h3",{id:"是如何找到与之相关的文档的",tabindex:"-1"},[i("是如何找到与之相关的文档的？ "),s("a",{class:"header-anchor",href:"#是如何找到与之相关的文档的","aria-label":'Permalink to "是如何找到与之相关的文档的？"'},"​")],-1),f=s("p",null,"有关这个功能块的文档真的很难找... 我花了好久才找到目标文档。",-1),D=s("p",null,"在 Amazon S3（或者说 AWS S3）的文档中，它有好几个版本：",-1),m=s("p",null,"第一个链接使用的是 AWS Signature Version 2 来进行签名和校验，但是这个版本是过时的，如果点到这个文档里面将会发现它提示说建议迁移到 Version 4：",-1),q=s("em",null,"Amazon Simple Storage Service API Reference",-1),S=s("p",null,"所以也才会有后面的三个链接可以参考，但是即便如此这依然令人头痛。",-1),b=s("p",null,"因为与阿里云 OSS 的文档不同的是，Amazon S3（或者说 AWS S3）的直传文档并没有给出一个可以参考的代码案例，也没有提供链接到 SDK 下属 API 的文档链接，只是简单的甩出来几个文档来说明和介绍整个签名和计算 hash 的流程和步骤。",-1),_=s("p",null,[i("AWS SDK now provides an easy way to create the POST policy with "),s("code",null,"createPresignedPost()"),i(".")],-1),P=s("p",null,"所以 AWS SDK 是提供了可以计算和创建预签名的 Policy 的 API 和函数封装的。",-1),v=s("p",null,[i("但是这个时候直接点到上面这段引用所关联到的有关 "),s("code",null,"createPresignedPost()"),i(" 的文档之后再去本地的 Node.js 服务端中尝试引入这个函数的时候，就会发现这个函数其实不存在，如果再返回回去看这份过时的 S3 SDK 的文档的时候，就可以发现 S3 SDK 部分的文档会提示说建议迁移：")],-1),w=s("p",null,"You are viewing the documentation for an older major version of the AWS SDK for JavaScript.",-1),I=s("p",null,[i("链接才能抵达现在最新版本的 JavaScript SDK 所在的文档，这个时候去搜索 "),s("code",null,"createPresignedPost()"),i(" 还是能发现其实没办法找到对应的函数的说明文档：")],-1),T=s("p",null,[s("img",{src:g,alt:""})],-1),W=s("p",null,[i("这是因为其实 S3 的 "),s("code",null,"createPresignedPost()"),i(" 函数是在单独的一个 Packages 的分类下面的，只有点击到了 Packages 下面的 "),s("code",null,"s3-presigned-post"),i(" 才能抵达真正的有关 Presigned Post 相关的文档：")],-1),j=s("p",null,[s("img",{src:y,alt:""})],-1),z=s("h2",{id:"贡献者",tabindex:"-1"},[i("贡献者 "),s("a",{class:"header-anchor",href:"#贡献者","aria-label":'Permalink to "贡献者"'},"​")],-1),N=s("h2",{id:"文件历史",tabindex:"-1"},[i("文件历史 "),s("a",{class:"header-anchor",href:"#文件历史","aria-label":'Permalink to "文件历史"'},"​")],-1),O=s("hr",{class:"footnotes-sep"},null,-1),R={class:"footnotes"},V={class:"footnotes-list"},J={id:"fn1",class:"footnote-item"},M=s("a",{href:"#fnref1",class:"footnote-backref"},"↩︎",-1);function x(L,U,K,X,Y,G){const k=l("NolebasePageProperties"),n=l("VPNolebaseInlineLinkPreview"),p=l("NolebaseGitContributors"),e=l("NolebaseGitChangelog");return o(),d("div",null,[A,a(k),E,s("p",null,[i("有关这些参数，可以通过 "),a(n,{href:"https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-HTTPPOSTForms.html#sigv4-HTTPPOSTFormFields",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Creating an HTML Form (Using AWS Signature Version 4) - Amazon Simple Storage Service")]),_:1}),i(" 文档查阅了解。 调用这个函数之后将会获得下面的返回值：")]),C,s("p",null,[a(n,{href:"https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-s3-presigned-post/",target:"_blank",rel:"noreferrer"},{default:t(()=>[F,i(" - AWS SDK for JavaScript v3")]),_:1})]),u,f,D,s("ul",null,[s("li",null,[a(n,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingHTTPPOST.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Browser-based uploads using POST (AWS signature version 2)")]),_:1})]),s("li",null,[a(n,{href:"https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-post-example.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Example: Browser-Based Upload using HTTP POST (Using AWS Signature Version 4) - Amazon Simple Storage Service")]),_:1})]),s("li",null,[a(n,{href:"https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-authentication-HTTPPOST.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Authenticating Requests: Browser-Based Uploads Using POST (AWS Signature Version 4) - Amazon Simple Storage Service")]),_:1})]),s("li",null,[a(n,{href:"https://docs.aws.amazon.com/AmazonS3/latest/API/browser-based-uploads-aws-amplify.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Browser-Based Uploads to Amazon S3 Using the AWS Amplify Library - Amazon Simple Storage Service")]),_:1})])]),m,s("blockquote",null,[s("p",null,[i("Amazon S3 now supports Signature Version 4, a protocol for authenticating inbound API requests to AWS services, in all AWS Regions. At this time, AWS Regions created before January 30, 2014 will continue to support the previous protocol, Signature Version 2. Any new regions after January 30, 2014 will support only Signature Version 4 and therefore all requests to those regions must be made with Signature Version 4. For more information, see "),a(n,{href:"https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-authentication-HTTPPOST.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Authenticating Requests in Browser-Based Uploads Using POST (AWS Signature Version 4)")]),_:1}),i(" in the "),q,i(".")])]),S,b,s("p",null,[i("这让我在尝试集成的时候头疼了好一会儿，翻了好多文档和 StackOverflow 以及技术博客来寻找蛛丝马迹。所幸我在一篇 "),a(n,{href:"https://stackoverflow.com/a/61998502/19954520",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("javascript - Amazon S3 POST api, and signing a policy with NodeJS")]),_:1}),i(" 的 StackOverflow 的问答中找到了一些头绪：")]),s("blockquote",null,[_,s("p",null,[i("Docs: "),a(n,{href:"https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#createPresignedPost-property",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#createPresignedPost-property")]),_:1})])]),P,v,s("blockquote",null,[w,s("p",null,[i("The modular AWS SDK for JavaScript (v3), the latest major version of AWS SDK for JavaScript, is now stable and recommended for general use. For more information, see the "),a(n,{href:"https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/migrating-to-v3.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Migration Guide")]),_:1}),i(" and "),a(n,{href:"https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/index.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("API Reference.")]),_:1})])]),s("p",null,[i("迁移一般而言也不是问题，这个时候再点到 "),a(n,{href:"https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/migrating-to-v3.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("Migration Guide")]),_:1}),i(" 的文档中才能了解到不同 SDK 的区别，不过... 这距离最终的答案依然还有一些距离。你其实需要点击上面这段引用的")]),s("blockquote",null,[s("p",null,[a(n,{href:"https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/index.html",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("API Reference.")]),_:1})])]),I,T,W,j,s("p",null,[i("文档在 "),a(n,{href:"https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-s3-presigned-post/",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("AWS SDK for JavaScript v3")]),_:1}),i("。")]),z,a(p),N,a(e),O,s("section",R,[s("ol",V,[s("li",J,[s("p",null,[i("在阿里云 OSS 的"),a(n,{href:"https://help.aliyun.com/zh/oss/use-cases/obtain-signature-information-from-the-server-and-upload-data-to-oss",target:"_blank",rel:"noreferrer"},{default:t(()=>[i("服务端签名直传")]),_:1}),i("文档中会有介绍到。 "),M])])])])])}const Z=r(c,[["render",x]]);export{H as __pageData,Z as default};
